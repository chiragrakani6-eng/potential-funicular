<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chirag Rakani - Accessible Tools Hub</title>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    
    <style>
        /* CSS STYLES - (unchanged) */
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #f0f2f5; color: #333; }
        .nav-bar { display: flex; background: #2c3e50; padding: 10px; justify-content: space-around; }
        .nav-btn { background: none; border: none; color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; padding: 10px; }
        .nav-btn:hover, .active-tab { border-bottom: 3px solid #3498db; color: #3498db; }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .tab-content { display: none; }
        .active-content { display: block; }
        .btn { display: inline-block; padding: 12px 20px; margin: 10px 0; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; width: 100%; }
        .btn-primary { background: #3498db; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #c0392b; }
        .btn-secondary { background: #6c757d; }
        .intro-box { background: #e8f5e9; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #d4e3d4; }
        .intro-box h2 { color: #27ae60; border-bottom: 2px solid #27ae60; padding-bottom: 5px; margin-top: 0; }
        .output-box { background: #f9f9f9; padding: 15px; margin-top: 10px; border: 2px solid #ccc; border-radius: 5px; min-height: 100px; white-space: pre-wrap; }
        .loading { color: #d35400; font-weight: bold; }
        #pdf-controls, .typing-controls { display: flex; align-items: center; gap: 10px; margin-top: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background: #f0f0ff; }
        #pdf-controls input[type="number"] { width: 60px; padding: 5px; text-align: center; }
        .typing-controls button { width: auto; padding: 5px 10px; margin: 0; }
        #practiceWord, #testParagraph { font-size: 1.2rem; font-weight: bold; color: #2c3e50; padding: 15px; border: 1px solid #3498db; border-radius: 5px; margin-bottom: 10px; min-height: 50px; background: #ecf0f1; }
        #userInput { width: 95%; padding: 10px; font-size: 1.1rem; border: 2px solid #27ae60; border-radius: 5px; }
        .correct { color: #27ae60; font-weight: bold; }
        .incorrect { color: #c0392b; font-weight: bold; }
        .result-box { text-align: center; font-size: 1.5rem; margin-top: 15px; padding: 15px; background: #fdf6e3; border-radius: 8px; }
        footer { text-align: center; margin-top: 50px; color: #7f8c8d; }
    </style>
</head>
<body>

    <nav class="nav-bar" role="tablist">
        <button class="nav-btn active-tab" onclick="openTab('home', this)" aria-selected="true">ЁЯПа Home</button>
        <button class="nav-btn" onclick="openTab('tools', this)" aria-selected="false">ЁЯЫая╕П Tools for the Visually Impaired</button>
    </nav>

    <div id="home" class="container tab-content active-content">
        <h1>ЁЯСЛ Welcome to Chirag's Ultimate Hub</h1>
        
        <div class="intro-box">
            <h2>About Me | рдореЗрд░рд╛ рдкрд░рд┐рдЪрдп | ркорк╛рк░рлЛ рккрк░рк┐ркЪркп</h2>
            
            <p>
                <strong>рд╣рд┐рдВрджреА:</strong> рдореЗрд░рд╛ рдирд╛рдо **рдЪрд┐рд░рд╛рдЧ рд░рд╛рдХрд╛рдгреА** рд╣реИ рдФрд░ рдореИрдВ **рдШрд░рд╛рдгрд╛ рдХрдЪреНрдЫ рдЧреБрдЬрд░рд╛рдд** рдХрд╛ рдирд┐рд╡рд╛рд╕реА рд╣реВрдБ рдореИрдВрдиреЗ рдмреНрд▓рд╛рдЗрдВрдб рд╕реНрдХреВрд▓ рднреБрдЬ рд╕реЗ 12рд╡реАрдВ рдХрдХреНрд╖рд╛ рдкреВрд░реА рдХреА рд╣реИ рдореЗрд░рд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рдЪреИрдЯ рд╕рдкреЛрд░реНрдЯ рдбрд╛рдЯрд╛ рдПрдВрдЯреНрд░реА рдпрд╛ рдХрд┐рд╕реА рднреА рдЯрд╛рдЗрдкрд┐рдВрдЧ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкрдж рдкрд░ рдХрд╛рд░реНрдп рдХрд░рдирд╛ рд╣реИ рдЬрд╣рд╛рдБ рдореИрдВ рдЕрдкрдиреА рдмреЗрд╣рддрд░реАрди рдЯрд╛рдЗрдкрд┐рдВрдЧ рджрдХреНрд╖рддрд╛ рдФрд░ рдЧреНрд░рд╛рд╣рдХ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдЕрдиреБрднрд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреВрдБ рдореИрдВ рдЕрдВрдЧреНрд░реЗрдЬреА рд╣рд┐рдВрджреА рдФрд░ рдЧреБрдЬрд░рд╛рддреА рдореЗрдВ рдкрд╛рд░рдВрдЧрдд рд╣реВрдБ рдореЗрд░рд╛ рдореБрдЦреНрдп рдЬреБрдиреВрди рджреГрд╖реНрдЯрд┐рдмрд╛рдзрд┐рдд рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реЗрд╕рд┐рдмрд▓ рдРрдкреНрд╕ рдФрд░ рдЧреЗрдореНрд╕ рдмрдирд╛рдирд╛ рд╣реИ рдореИрдВ рдПрдХ рд▓реЗрдЦрдХ рднреА рд╣реВрдБ рдФрд░ рдореЗрд░реА рдХреБрдЫ рдХрд┐рддрд╛рдмреЗрдВ Amazon рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ
            </p>

            <p>
                <strong>English:</strong> I am **Chirag Rakani** from **Gharana Kutch Gujarat** I am a highly motivated and detail-oriented individual with a strong passion for communication and problem-solving Seeking a role in chat support data entry or any typing-related position where I can utilize my exceptional typing skills and customer interaction experience to contribute to organizational success I completed my 12th Grade at Blind School Bhuj I am dedicated to creating accessible apps and games for the visually impaired and I am also an author with books available on Amazon
            </p>

            <p>
                <strong>ркЧрлБркЬрк░рк╛ркдрлА:</strong> ркорк╛рк░рлБркВ ркирк╛рко **ркЪрк┐рк░рк╛ркЧ рк░рк╛ркХрк╛ркгрлА** ркЫрлЗ ркЕркирлЗ рк╣рлБркВ **ркШрк░рк╛ркгрк╛ ркХркЪрлНркЫ ркЧрлБркЬрк░рк╛ркд** ркирлЛ рк░рк╣рлЗрк╡рк╛рк╕рлА ркЫрлБркВ ркорлЗркВ ркмрлНрк▓рк╛ркЗркирлНркб рк╕рлНркХрлВрк▓ ркнрлБркЬ ркорк╛ркВркерлА 12ркорлБркВ ркзрлЛрк░ркг рккрлВрк░рлБркВ ркХрк░рлНркпрлБркВ ркЫрлЗ ркорк╛рк░рлЛ ркорлБркЦрлНркп рк╣рлЗркдрлБ ркЪрлЗркЯ рк╕рккрлЛрк░рлНркЯ ркбрлЗркЯрк╛ ркПркирлНркЯрлНрк░рлА ркЕркерк╡рк╛ ркЯрк╛ркИрккрк┐ркВркЧ рк╕ркВркмркВркзрк┐ркд ркХрлЛркИ рккркг ркнрлВркорк┐ркХрк╛ркорк╛ркВ ркХрк╛рко ркХрк░рк╡рк╛ркирлЛ ркЫрлЗ ркЬрлНркпрк╛ркВ рк╣рлБркВ ркорк╛рк░рлА ркЕрккрк╡рк╛ркжрк░рлВркк ркЯрк╛ркЗрккрк┐ркВркЧ ркХрлМрк╢рк▓рлНркпрлЛ ркЕркирлЗ ркЧрлНрк░рк╛рк╣ркХ рк╕ркВрккрк░рлНркХ ркЕркирлБркнрк╡ркирлЛ ркЙрккркпрлЛркЧ рк╕ркВрк╕рлНркерк╛ркХрлАркп рк╕рклрк│ркдрк╛ ркорк╛ркЯрлЗ ркХрк░рлА рк╢ркХрлБркВ рк╣рлБркВ ркжрлНрк░рк╖рлНркЯрк┐рк╣рлАрки рк▓рлЛркХрлЛ ркорк╛ркЯрлЗ рк╕рлБрк▓ркн ркПрккрлНрк╕ ркЕркирлЗ ркЧрлЗркорлНрк╕ ркмркирк╛рк╡рк╡рк╛ркорк╛ркВ рккркг рк╕ркорк░рлНрккрк┐ркд ркЫрлБркВ ркЕркирлЗ ркПркорлЗркЭрлЛрки рккрк░ ркорк╛рк░рк╛ рккрлБрк╕рлНркдркХрлЛ рккркг ркЙрккрк▓ркмрлНркз ркЫрлЗ
            </p>

            <p>
                ЁЯУЮ Contact **9737796825** | ЁЯУз Email **chiragrakani6@gmail.com**
            </p>
        </div>
        
        <br>
        <h2>ЁЯУЪ My Books on Amazon</h2>
        <a href="https://www.amazon.in/s?i=digital-text&rh=p_27%3AChirag+Rakani&s=books&Adv-Srch-Books-Submit.x=28&Adv-Srch-Books-Submit.y=1&qid=1708845014&ref=sr_adv_b" target="_blank">
            <button class="btn btn-secondary">Check Out My Amazon Books</button>
        </a>
    </div>

    <div id="tools" class="container tab-content">
        <h1>ЁЯЫая╕П Tools for the Visually Impaired</h1>

        <div class="section">
            <h3>тЬНя╕П 1 Spelling & Typing Practice</h3>
            <p>рд╢рдмреНрдж рдХреЛ рд╕реБрдиреЗрдВ рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдиреЗрдВ рдФрд░ рдЯрд╛рдЗрдк рдХрд░реЗрдВ</p>
            <p><strong>рд░рд┐рдкреАрдЯ рд╢реЙрд░реНрдЯрдХрдЯ:</strong> рд╢рдмреНрдж рдФрд░ рдЙрдкрдпреЛрдЧ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП <strong>Ctrl + R</strong> рдЧрд▓рдд рд╕реНрдкреЗрд▓рд┐рдВрдЧ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП <strong>F2</strong></p>
            
            <div id="practiceWord" aria-live="polite">Click 'Next Word' to begin</div>
            
            <input type="text" id="practiceInput" placeholder="Type the word here" aria-label="Type the spoken word here" oninput="handleSpellingInput(event)" onkeydown="handleSpellingInput(event)" style="width: 95%; padding: 10px; font-size: 1.1rem; border-color: #3498db;">
            
            <div class="typing-controls">
                <button class="btn btn-primary" onclick="nextWord()">ЁЯФД Next Word</button>
                <button class="btn btn-success" onclick="readWord(currentPracticeWord)">ЁЯФК Listen Word Again</button>
                <button class="btn btn-secondary" onclick="readUsage(currentPracticeWord)">ЁЯФК Listen Usage</button>
                <span id="spellFeedback" aria-live="assertive"></span>
            </div>
        </div>

        <hr>

        <div class="section">
            <h3>тП▒я╕П 2 Typing Speed Test WPM</h3>
            <p>Type the provided paragraph to check your speed</p>
            
            <div id="testParagraph" tabindex="0" role="textbox">Type the paragraph and click 'Start/Restart Test'</div>
            
            <textarea id="typingTestInput" placeholder="Start typing here" oninput="startTypingTest()" rows="5" aria-label="Typing test area" style="width: 95%; padding: 10px; font-size: 1.1rem; border-color: #27ae60;"></textarea>
            
            <div class="typing-controls">
                <button class="btn btn-success" onclick="resetTypingTest()">тЦ╢я╕П Start/Restart Test</button>
                <div id="timer" aria-live="polite" style="font-weight: bold;">Time 0s</div>
                <div id="wpmResult" class="result-box" aria-live="polite">WPM 0</div>
            </div>
        </div>

        <hr>

        <div class="section">
            <h3>ЁЯСБя╕П 3 Universal Document Reader</h3>
            <p>Upload <strong>Image</strong> or <strong>PDF</strong> I will extract text for you</p>
            
            <input type="file" id="fileInput" accept="image/*, .pdf" class="btn" aria-label="Upload File">
            
            <button class="btn btn-success" onclick="processFile()">Read Document</button>
            
            <div id="pdf-controls" style="display:none;" role="toolbar">
                <strong>Go to Page:</strong>
                <input type="number" id="pageNumberInput" min="1" value="1" aria-label="Page number input">
                <button class="btn btn-primary" onclick="handleGoToPage()">Go</button>
                <span id="pageInfo" aria-live="polite"></span>
            </div>

            <h3>Result:</h3>
            <div id="doc-output" class="output-box" aria-live="polite" tabindex="0">
                Text will appear here
            </div>
        </div>

        <hr>

        <div class="section">
            <h3>ЁЯУН 4 Where Am I Location</h3>
            <button class="btn btn-primary" onclick="getLocation()">Get Current Location</button>
            <div id="location-output" class="output-box" aria-live="polite">Location info will appear here</div>
        </div>
    </div>

    <footer><p>┬й 2025 Chirag Rakani</p></footer>

    <script>
        // Setup PDF Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

        // --- Global Variables ---
        let currentPdfDocument = null;
        let totalPdfPages = 0;

        // --- Typing Tool Variables ---
        const spellingWordsMap = {
            "accessibility": "We are designing this tool for better web accessibility",
            "computer": "I use the computer for all my data entry tasks",
            "keyboard": "My typing speed is fast because I use the keyboard efficiently",
            "software": "I am competent in using Microsoft Office software",
            "screenreader": "A screenreader is essential for navigating the internet",
            "braille": "I learned to read using the braille system in school",
            "typing": "I am seeking a typing-related position",
            "communication": "Strong communication skills are needed for chat support",
            "technology": "Assistive technology helps visually impaired people work effectively",
            "challenge": "I enjoy solving puzzles and logical challenges",
            "dedication": "Success requires dedication and consistent practice",
            "confidence": "My confidence in my skills is very high",
            "amazing": "This accessibility feature is truly amazing",
            "support": "I can provide excellent customer support",
            "document": "Please review the document before printing",
            "navigation": "Website navigation must be simple and clear",
            "proficiency": "I have high proficiency in multilingual communication",
            "essential": "Attention to detail is essential for data entry",
            "accurate": "I ensure fast and accurate typing",
            "experience": "I have customer interaction experience",
            "organization": "I wish to contribute to the organization's success",
            "solution": "The problem-solving team found a perfect solution",
            "applicant": "The job applicant submitted a strong resume",
            "objective": "My career objective is to work in tech support",
            "multilingual": "I am fluent making me a multilingual candidate",
            "approachable": "I am a friendly and approachable person",
            "customer": "I focus on helping every customer resolve their issues",
            "service": "I am passionate about customer service",
            "position": "I am seeking a data entry position",
            "utilize": "I will utilize my skills effectively",
            "contribute": "I am eager to contribute to the team",
            "gujarat": "I am currently living in Gujarat"
        };
        const spellingWords = Object.keys(spellingWordsMap);
        let currentPracticeWord = "";
        let currentUsageSentence = ""; 
        let correctAttempts = 0; 
        let currentRequiredAttempts = 1; 
        
        // --- Typing Test Variables ---
        const testText = "Quickly type this paragraph to test your speed Focused practice on typing skills is essential for effective communication and data entry especially when using assistive technology Aim for accuracy and speed to improve your overall proficiency"; // Punctuation removed
        let timerInterval = null;
        let startTime = 0;
        let testActive = false;
        
        // --- TAB SWITCHING FUNCTION (UNCHANGED) ---
        function openTab(name, clickedElement) {
            document.querySelectorAll('.tab-content').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
            
            const targetContent = document.getElementById(name);
            if (targetContent) {
                targetContent.style.display = 'block';
            }
            
            if (clickedElement) {
                 clickedElement.classList.add('active-tab');
            }
            if (name === 'tools') {
                const firstHeading = document.querySelector('#tools h3');
                if (firstHeading) {
                    firstHeading.focus();
                }
            }
        }

        // --- SPEECH SYNTHESIS FUNCTIONS (RATE = 0.6) ---
        function readWord(text) {
            if (!('speechSynthesis' in window)) return;
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            const speech = new SpeechSynthesisUtterance(text);
            speech.rate = 0.6; 
            speech.lang = 'en-US'; 
            window.speechSynthesis.speak(speech);
        }

        function spellOutWord(word) {
            if (!('speechSynthesis' in window)) {
                document.getElementById('spellFeedback').innerText = "ERROR Speech feature not available in your browser";
                return;
            }
            window.speechSynthesis.cancel();
            
            const spelledText = word.toUpperCase().split('').join(' '); // Using space instead of dot
            
            const speech = new SpeechSynthesisUtterance("The correct spelling is " + spelledText + " Please try again");
            speech.rate = 0.6; 
            speech.lang = 'en-US'; 
            window.speechSynthesis.speak(speech);
        }
        
        // NEW FUNCTION: Read the usage sentence
        function readUsage(word) {
            if (!currentPracticeWord) return;
            const usage = spellingWordsMap[word];
            const message = `Use in a sentence ${usage}`;
            readWord(message);
        }
        // --- END SPEECH SYNTHESIS FUNCTIONS ---


        // --- SPELLING AND TYPING PRACTICE LOGIC ---

        function nextWord() {
            if (!('speechSynthesis' in window)) {
                 document.getElementById('spellFeedback').innerText = "ERROR Speech feature not available in your browser Cannot start spelling practice";
                 return;
            }

            correctAttempts = 0; 
            currentRequiredAttempts = 1; 
            
            const randomIndex = Math.floor(Math.random() * spellingWords.length);
            currentPracticeWord = spellingWords[randomIndex];
            currentUsageSentence = spellingWordsMap[currentPracticeWord]; 
            
            const input = document.getElementById('practiceInput');
            const feedback = document.getElementById('spellFeedback');

            document.getElementById('practiceWord').innerText = `ЁЯФК Word ${currentPracticeWord} | ЁЯУЦ Usage ${currentUsageSentence}`;
            input.value = "";
            input.disabled = false;
            feedback.innerText = `Word loaded Type it correctly Required ${currentRequiredAttempts} time Listen carefully`;
            input.style.borderColor = '#3498db';
            input.focus(); 

            // Announce word, then usage sentence
            readWord(`The new word is ${currentPracticeWord}`);
            setTimeout(() => readUsage(currentPracticeWord), 2000); 
        }

        function handleSpellingInput(event) {
            const input = document.getElementById('practiceInput');
            const feedback = document.getElementById('spellFeedback');
            const correctWord = currentPracticeWord.toLowerCase();
            
            // 1. Handle Enter Key Press
            if (event.type === 'keydown' && event.key === 'Enter') {
                event.preventDefault(); 
                
                if (correctAttempts === currentRequiredAttempts) {
                    readWord("Moving to next word");
                    nextWord();
                } else if (currentPracticeWord) {
                    feedback.innerHTML = `<span class="incorrect">тЭМ Hold on</span> You must type the word correctly ${currentRequiredAttempts - correctAttempts} more time s to finish`;
                }
                return;
            }
            
            // 2. Handle F2 Key Press
            if (event.type === 'keydown' && event.key === 'F2') {
                event.preventDefault(); 
                
                if (currentRequiredAttempts === 3 && correctAttempts < 3) {
                    readWord("Repeating the correct spelling for the failed word");
                    spellOutWord(currentPracticeWord);
                } else {
                    readWord("F2 is for repeating spelling when a word is failed");
                }
                return;
            }
            
            // Only proceed on 'input' event for live checking
            if (event.type !== 'input') return;

            const typedWord = input.value.trim().toLowerCase();
            
            if (!currentPracticeWord) {
                feedback.innerText = "Click 'Next Word' to start";
                return;
            }

            // Check if the full word is correct
            if (typedWord === correctWord) {
                if (correctAttempts === currentRequiredAttempts) return; 

                correctAttempts++;
                input.value = ""; // Clear input for next attempt
                
                if (correctAttempts < currentRequiredAttempts) {
                    const remaining = currentRequiredAttempts - correctAttempts;
                    feedback.innerHTML = `<span class="correct">тЬЕ Correct ${correctAttempts}/${currentRequiredAttempts}</span> Type it again ${remaining} more time s needed`;
                    readWord(`Correct Please type it again`);
                    input.style.borderColor = '#27ae60';
                } else {
                    feedback.innerHTML = `<span class="correct">ЁЯОЙ Excellent</span> You got it ${currentRequiredAttempts} times Press <strong>ENTER</strong> for the next word`;
                    readWord(`Excellent Press Enter for the next word`);
                    input.style.borderColor = '#3498db'; 
                }
            } 
            // Check for incorrect typing if the length is significant
            else if (typedWord.length > correctWord.length || (typedWord.length > 0 && !correctWord.startsWith(typedWord))) {
                // Incorrect attempt: Reset attempts and set required attempts to 3
                currentRequiredAttempts = 3; 
                correctAttempts = 0; 
                input.style.borderColor = '#c0392b';
                input.value = ""; 

                // Announce error and spell out the word immediately
                readWord(`Incorrect Attempts reset Listen for the spelling`);
                spellOutWord(currentPracticeWord);
                
                feedback.innerHTML = `<span class="incorrect">тЭМ Incorrect Attempts reset to 0</span> Spell it out by pressing F2 Now you must type it **3 times** correctly`;
            }
            else {
                 // Partial match
                feedback.innerText = `Keep typing ${correctAttempts}/${currentRequiredAttempts} attempts done`;
                input.style.borderColor = '#3498db';
            }
        }
        
        // --- REPEAT SHORTCUT LOGIC (Ctrl+R) ---
        function repeatCurrentWordAndFeedback() {
            if (!currentPracticeWord) {
                readWord("No word loaded Click next word to begin");
                return;
            }
            
            const feedbackText = document.getElementById('spellFeedback').innerText;
            
            // Read Word and Usage Sentence
            readWord(`Repeating the current word ${currentPracticeWord}`);
            setTimeout(() => readUsage(currentPracticeWord), 1500);
            
            // Read the current instruction feedback (if necessary)
            setTimeout(() => readWord(`Current instruction is ${feedbackText}`), 4000); 
        }

        window.addEventListener('keydown', (event) => {
            // Check for Ctrl (Windows/Linux) or Command (Mac) + R
            if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 'r') {
                event.preventDefault(); // Prevent page refresh
                repeatCurrentWordAndFeedback();
            }
        });

        // --- TYPING SPEED TEST LOGIC (Punctuation removed from testText) ---

        function resetTypingTest() {
            clearInterval(timerInterval);
            timerInterval = null;
            startTime = 0;
            testActive = false;
            
            const paragraph = document.getElementById('testParagraph');
            const input = document.getElementById('typingTestInput');
            
            paragraph.innerText = testText;
            paragraph.setAttribute('tabindex', '0');
            input.value = "";
            input.style.backgroundColor = 'white';
            
            document.getElementById('timer').innerText = "Time 0s";
            document.getElementById('wpmResult').innerText = "WPM 0";
            input.focus();
            
            readWord("Typing test started Type the paragraph above");
        }

        function startTypingTest() {
            if (!testActive) {
                testActive = true;
                startTime = new Date().getTime();
                
                timerInterval = setInterval(() => {
                    const elapsed = Math.floor((new Date().getTime() - startTime) / 1000);
                    document.getElementById('timer').innerText = `Time ${elapsed}s`;
                    calculateWPM(elapsed);
                }, 1000);
            }
            
            checkTypingAccuracy();
        }
        
        function checkTypingAccuracy() {
            const input = document.getElementById('typingTestInput');
            const typedText = input.value;
            const paragraph = document.getElementById('testParagraph');
            let highlightedText = '';
            let correctChars = 0;

            for (let i = 0; i < testText.length; i++) {
                const char = testText[i];
                const typedChar = typedText[i];

                if (typedChar === undefined) {
                    highlightedText += `<span style="background-color: #f0f0f0;">${char}</span>`;
                } else if (char === typedChar) {
                    highlightedText += `<span style="color: #27ae60;">${char}</span>`;
                    correctChars++;
                } else {
                    highlightedText += `<span style="color: white; background-color: #c0392b;">${char}</span>`;
                }
            }
            
            paragraph.innerHTML = highlightedText;
            
            if (typedText.length >= testText.length && typedText === testText.substring(0, typedText.length)) {
                endTypingTest();
            }
        }

        function calculateWPM(elapsedSeconds) {
            const input = document.getElementById('typingTestInput');
            const typedText = input.value;
            
            if (elapsedSeconds === 0) return;
            
            const wordsTyped = typedText.length / 5;
            const minutes = elapsedSeconds / 60;
            const wpm = Math.round(wordsTyped / minutes);
            
            document.getElementById('wpmResult').innerText = `WPM ${wpm}`;
        }

        function endTypingTest() {
            clearInterval(timerInterval);
            testActive = false;
            
            const input = document.getElementById('typingTestInput');
            const typedText = input.value;
            const elapsed = Math.floor((new Date().getTime() - startTime) / 1000);

            let finalCorrectChars = 0;
            for (let i = 0; i < testText.length; i++) {
                if (typedText[i] === testText[i]) {
                    finalCorrectChars++;
                }
            }
            
            const finalWords = finalCorrectChars / 5;
            const minutes = elapsed / 60;
            const finalWPM = Math.round(finalWords / minutes);
            
            document.getElementById('wpmResult').innerText = `Final WPM ${finalWPM}`;
            readWord(`Test complete Your speed is ${finalWPM} words per minute`);
            input.style.backgroundColor = '#e8f5e9'; 
        }

        // --- LOCATION TOOL LOGIC (UNCHANGED) ---
        function getLocation() {
            let out = document.getElementById('location-output');
            out.innerText = "Locating";
            if(!navigator.geolocation) { 
                out.innerText="Geolocation is Not supported by this browser Please use a modern browser Chrome Edge Firefox"; 
                return; 
            }
            navigator.geolocation.getCurrentPosition(
                p => out.innerHTML = `тЬЕ Location Found Lat ${p.coords.latitude} Lon ${p.coords.longitude}<br><a href='http://googleusercontent.com/maps.google.com/9{p.coords.latitude},${p.coords.longitude}' target='_blank'>Click to open Map</a>`,
                (error) => {
                    let errorMessage;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = "тЭМ Error Location permission denied Please allow location access in your browser settings";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = "тЭМ Error Location information is unavailable";
                            break;
                        case error.TIMEOUT:
                            errorMessage = "тЭМ Error The request to get user location timed out";
                            break;
                        case error.UNKNOWN_ERROR:
                            errorMessage = "тЭМ Error An unknown error occurred";
                            break;
                        default:
                            errorMessage = "тЭМ Error finding location";
                    }
                    out.innerText = errorMessage;
                }
            );
        }

        // --- DOCUMENT READER (PDF + Image) LOGIC (UNCHANGED) ---
        async function displayPage(pageNum) {
            const output = document.getElementById('doc-output');
            const pageInfo = document.getElementById('pageInfo');
            
            if (!currentPdfDocument || pageNum < 1 || pageNum > totalPdfPages || isNaN(pageNum)) {
                output.innerText = "Error Please enter a valid page number between 1 and " + totalPdfPages;
                pageInfo.innerText = `Total Pages ${totalPdfPages}`;
                return;
            }

            output.innerHTML = "<span class='loading'>Loading Page " + pageNum + " Please wait</span>";
            
            try {
                const page = await currentPdfDocument.getPage(pageNum);
                const textContent = await page.getTextContent();
                // Removed punctuation from extracted text as well (simple approach)
                const pageText = textContent.items.map(item => item.str.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"")).join(' ');
                
                output.innerText = `--- PAGE ${pageNum} ---\n\n` + (pageText.trim() || `Page ${pageNum} seems empty`);
                pageInfo.innerText = `Page ${pageNum} of ${totalPdfPages}`;
                document.getElementById('pageNumberInput').value = pageNum;
                output.focus();
            } catch (e) {
                output.innerText = `тЭМ Error reading Page ${pageNum} ` + e.message;
            }
        }

        function handleGoToPage() {
            const input = document.getElementById('pageNumberInput');
            const pageNum = parseInt(input.value);
            
            if (currentPdfDocument) {
                displayPage(pageNum);
            } else {
                document.getElementById('doc-output').innerText = "Please upload a PDF first to use page navigation";
            }
        }

        async function processFile() {
            const input = document.getElementById('fileInput');
            const output = document.getElementById('doc-output');
            const pdfControls = document.getElementById('pdf-controls');
            
            currentPdfDocument = null;
            totalPdfPages = 0;
            pdfControls.style.display = 'none';

            if (input.files.length === 0) {
                output.innerText = "Please select a file first";
                return;
            }

            const file = input.files[0];
            output.innerHTML = "<span class='loading'>Processing Please wait</span>";

            // 1. Handle PDF
            if (file.type === 'application/pdf') {
                 if (typeof pdfjsLib === 'undefined') {
                    output.innerText = "тЭМ PDF Reader Error External library PDFjs failed to load Please check your internet connection";
                    return;
                }

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
                    
                    currentPdfDocument = pdf;
                    totalPdfPages = pdf.numPages;
                    
                    document.getElementById('pageNumberInput').max = totalPdfPages;
                    pdfControls.style.display = 'flex'; 
                    
                    await displayPage(1);

                } catch (e) {
                    output.innerText = "тЭМ Error reading PDF Make sure the file is not corrupted or check console for details " + e.message;
                    pdfControls.style.display = 'none';
                }
            } 
            // 2. Handle Image (Tesseract OCR)
            else if (file.type.startsWith('image/')) {
                pdfControls.style.display = 'none'; 
                
                if (typeof Tesseract === 'undefined') {
                    output.innerText = "тЭМ OCR Reader Error External library Tesseractjs failed to load Please check your internet connection";
                    return;
                }

                Tesseract.recognize(
                    file,
                    'eng',
                    { logger: m => console.log(m) }
                ).then(({ data: { text } }) => {
                    // Remove punctuation from Tesseract output
                    const cleanedText = text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
                    output.innerText = cleanedText;
                }).catch(err => {
                    output.innerText = "тЭМ Error reading Image Tesseract failed to recognize text";
                });
            } else {
                output.innerText = "File format not supported Please use PDF or Image JPG/PNG";
            }
        }
        
        // Set Home tab as active on load
        window.onload = function() {
            const homeButton = document.querySelector('.nav-btn');
            if(homeButton) {
                openTab('home', homeButton); 
            }
            
            document.getElementById('typingTestInput').value = ""; 
            nextWord(); // Load first word for spelling practice on startup
        };
    </script>
</body>
</html>