<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chirag Rakani â€” Accessible Tools & Games Hub</title>

  <meta name="description" content="Accessible web hub by Chirag Rakani â€” typing practice, OCR reader, screen-reader friendly games, and tools for visually impaired users.">
  <meta name="theme-color" content="#2c3e50">

  <!-- Tesseract & PDF.js -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

  <style>
    :root{ --bg:#f4f7fb; --card:#fff; --accent:#2c3e50; --accent-2:#27ae60; --muted:#6b7280; font-family:"Segoe UI",Roboto,Arial,sans-serif; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#111;line-height:1.45}
    header{background:var(--accent);color:#fff;padding:14px 16px;display:flex;align-items:center;gap:10px}
    .container{max-width:980px;margin:18px auto;padding:0 14px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:320px 1fr}}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    .btn{display:inline-block;padding:10px 12px;border-radius:8px;border:0;background:var(--accent-2);color:#fff;cursor:pointer;font-weight:600}
    .small{font-size:0.95rem;color:var(--muted)}
    .output-box{background:#f9f9f9;padding:12px;border:2px solid #ccc;border-radius:6px;min-height:120px;white-space:pre-wrap}
    .typing-controls{display:flex;gap:8px;align-items:center;margin-top:8px}
    input[type="file"]{padding:8px}
    .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <div style="width:56px;height:56px;border-radius:10px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)">CR</div>
      <div>
        <h1 style="margin:0;font-size:1.05rem">Chirag's Accessible Tools & Games Hub</h1>
        <div class="small">Typing, OCR, Auto-read & Accessible games</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Sidebar -->
      <aside class="card">
        <h2>About Me</h2>
        <p class="small"><strong>Chirag Rakani</strong> â€” Gharana, Kutch, Gujarat. Built accessible web tools for visually impaired users. Fluent in Hindi, Gujarati & English.</p>

        <h3>Contact</h3>
        <p class="small">ğŸ“ 9737796825<br>âœ‰ï¸ <a href="mailto:chiragrakani6@gmail.com">chiragrakani6@gmail.com</a></p>

        <h3>Follow</h3>
        <div class="small">
          <a href="https://youtube.com/shorts/Us4sDykOYtc?si=ITbIS3l6enuNzF29" target="_blank">YouTube</a> â€¢
          <a href="https://www.facebook.com/share/1DH4fAcwqU/" target="_blank">Facebook</a> â€¢
          <a href="https://www.instagram.com/koli.chirag?igsh=cGNyaTIyNXQ1NWM2" target="_blank">Instagram</a>
        </div>
      </aside>

      <!-- Main -->
      <section>
        <!-- Typing Practice: NEW behavior as requested -->
        <article id="typing" class="card" aria-labelledby="typing-h">
          <h2 id="typing-h">Typing Practice â€” Endless Spelling Drill</h2>
          <p class="small">
            Rules: If you type the word correctly on first try â†’ automatic next word.  
            If you make a wrong attempt first, you must type the correct word <strong>3 times</strong> to proceed.  
            Press <strong>Spell</strong> to hear spelling (same as F2).
          </p>

          <div id="practiceWord" class="small" style="padding:10px;border:1px solid #eee;border-radius:6px;background:#fbfff6;margin-bottom:8px;">Click Next to start</div>

          <input id="practiceInput" type="text" placeholder="Type the word here" aria-label="Type the spoken word" style="width:100%;padding:10px;font-size:1rem">

          <div class="typing-controls">
            <button class="btn" id="nextWordBtn">ğŸ”„ Next</button>
            <button class="btn" id="listenBtn">ğŸ”Š Listen</button>
            <button class="btn" id="spellBtn" style="background:#3b82f6">ğŸ”¡ Spell</button>
            <div id="spellFeedback" aria-live="assertive" style="margin-left:8px;font-weight:700;color:#333"></div>
          </div>
        </article>

        <!-- OCR -->
        <article id="ocr" class="card" style="margin-top:12px">
          <h2>Document Reader (OCR + Auto Read)</h2>
          <input type="file" id="fileInput" accept="image/*, .pdf" style="margin-top:8px">
          <div style="margin-top:8px">
            <button class="btn" onclick="processFile()">Read Document</button>
            <div id="pdf-controls" style="display:none;margin-top:8px">
              <label>Page:
                <input type="number" id="pageNumberInput" min="1" value="1" style="width:70px;margin-left:6px">
              </label>
              <button class="btn" onclick="handleGoToPage()">Go</button>
              <span id="pageInfo" class="small"></span>
            </div>
          </div>

          <h3 style="margin-top:12px">Result:</h3>
          <div id="doc-output" class="output-box" tabindex="0" aria-live="polite">Text will appear here...</div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <label><input type="checkbox" id="autoLang" checked> Auto-detect</label>
            <label style="margin-left:6px">Force:
              <select id="forceLang">
                <option value="">Auto</option>
                <option value="en-IN">English</option>
                <option value="hi-IN">Hindi</option>
                <option value="gu-IN">Gujarati</option>
              </select>
            </label>
            <button id="readDoc" class="btn">ğŸ”Š Read</button>
            <button id="stopRead" class="btn" style="background:#c0392b">â¹ Stop</button>
            <div id="readStatus" class="small" style="margin-left:8px"></div>
          </div>
        </article>

        <!-- Games (kept minimal) -->
        <article id="games" class="card" style="margin-top:12px">
          <h2>Games â€” Accessible</h2>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button onclick="window.open('https://lichess.org','_blank')" class="btn">â™Ÿï¸ Chess (Lichess)</button>
            <button id="hand-cricket-btn" class="btn">ğŸ Hand Cricket</button>
            <div id="hand-cricket" style="display:none;margin-top:8px">
              <div id="hc-status" class="small">Ready</div>
              <input id="hc-input" type="number" min="0" max="6" style="width:90px;margin-top:6px">
              <button class="btn" id="hc-play">Play</button>
              <button class="btn" id="hc-reset" style="background:#777">Reset</button>
            </div>

            <button id="snl-btn" class="btn">ğŸ² Snakes & Ladders</button>
            <div id="snl" style="display:none;margin-top:8px">
              <div id="snl-status" class="small">Ready</div>
              <button class="btn" id="snl-roll">Roll</button>
              <button class="btn" id="snl-reset" style="background:#777">Reset</button>
              <div class="dice" id="snl-dice">-</div>
              <div id="snl-board"></div>
            </div>

            <button id="ludo-btn" class="btn">ğŸ¯ Ludo Race</button>
            <div id="ludo" style="display:none;margin-top:8px">
              <div id="ludo-status" class="small">Ready</div>
              <button class="btn" id="ludo-roll">Roll</button>
              <button class="btn" id="ludo-reset" style="background:#777">Reset</button>
              <div id="ludo-scores" class="small"></div>
            </div>
          </div>
        </article>

      </section>
    </div>
  </main>

  <footer style="padding:16px;text-align:center;color:#666">Â© 2025 Chirag Rakani â€” Accessible Tools Hub</footer>

  <div id="game-announce" class="sr-only" aria-live="assertive"></div>

<script>
/* ----------------- Speech helper ----------------- */
function speakText(text, lang='en-IN', rate=0.95){
  if(!('speechSynthesis' in window)) return;
  try{ window.speechSynthesis.cancel(); } catch(e){}
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.rate = rate;
  window.speechSynthesis.speak(u);
}

/* ------------- Typing practice logic ------------- */
/*
Behavior:
- If user types word correctly on first attempt -> automatically move to next word.
- If user typed wrong at least once before first correct -> require 3 correct typings to move on.
- Spell button (and F2 if keyboard) will speak the spelled letters.
*/

const spellingWords = [
  "accessibility","computer","keyboard","software","screenreader","braille","typing",
  "success","motivation","efficiency","communication","technology","challenge","dedication",
  "confidence","amazing","support","document","location","internet","navigation","paragraph",
  "proficiency","essential","accurate","experience","organization","solution","applicant",
  "objective","multilingual","approachable","customer","service","position","utilize","contribute","gujarat"
];

let currentPracticeWord = "";
let madeWrongAttempt = false;   // true if user typed incorrectly at least once for current word
let correctStreak = 0;         // number of consecutive correct typings after wrong attempt

const practiceInput = document.getElementById('practiceInput');
const practiceWordDiv = document.getElementById('practiceWord');
const feedbackDiv = document.getElementById('spellFeedback');
const nextBtn = document.getElementById('nextWordBtn');
const listenBtn = document.getElementById('listenBtn');
const spellBtn = document.getElementById('spellBtn');

function pickNextWord(){
  // Reset state
  madeWrongAttempt = false;
  correctStreak = 0;
  const idx = Math.floor(Math.random()*spellingWords.length);
  currentPracticeWord = spellingWords[idx];
  practiceWordDiv.innerText = "ğŸ”Š Listen: " + currentPracticeWord;
  feedbackDiv.innerText = `Type the word. If you make a mistake, you'll need to type it correctly 3 times.`;
  practiceInput.value = "";
  practiceInput.focus();
  // speak the word clearly
  setTimeout(()=> speakText(currentPracticeWord), 200);
}

function spellOut(word){
  if(!word) return;
  const spelled = word.toUpperCase().split('').join('. ');
  speakText("Spelling: " + spelled + ".");
  feedbackDiv.innerText = `Spelling: ${word.toUpperCase().split('').join(' Â· ')}`;
}

function onUserTyped(e){
  const typed = practiceInput.value.trim().toLowerCase();
  const correct = currentPracticeWord.toLowerCase();

  // Key handling: Enter and F2
  if(e.type === 'keydown'){
    if(e.key === 'F2'){
      e.preventDefault();
      spellOut(currentPracticeWord);
      return;
    }
    if(e.key === 'Enter'){
      e.preventDefault();
      // If user presses Enter, only proceed if conditions met
      if(!madeWrongAttempt){
        // if never made wrong attempt but hasn't typed yet, ignore
        if(typed === correct){
          pickNextWord();
        } else {
          feedbackDiv.innerText = "Type the word correctly (or press Next).";
          speakText("Type the word correctly.");
        }
      } else {
        if(correctStreak >= 3){
          pickNextWord();
        } else {
          feedbackDiv.innerText = `You need ${3 - correctStreak} more correct attempt(s).`;
          speakText(`You need ${3 - correctStreak} more correct attempts.`);
        }
      }
      return;
    }
  }

  // Only process on input events for live checking
  if(e.type !== 'input') return;

  if(!currentPracticeWord){
    feedbackDiv.innerText = "Press Next to start.";
    return;
  }

  if(typed === correct){
    // If user had NOT made any wrong attempts yet -> immediate success and go next.
    if(!madeWrongAttempt){
      feedbackDiv.innerHTML = `<span style="color:green">âœ… Correct â€” moving to next word.</span>`;
      speakText("Correct. Next word.");
      // small delay then next
      setTimeout(()=> pickNextWord(), 600);
      return;
    } else {
      // User had made a wrong attempt earlier â€” count streak
      correctStreak++;
      if(correctStreak < 3){
        feedbackDiv.innerHTML = `<span style="color:green">âœ… Correct (${correctStreak}/3) â€” type again.</span>`;
        speakText(`Correct. ${correctStreak} of 3.`);
        practiceInput.value = "";
        practiceInput.focus();
        return;
      } else {
        // reached 3 correct in a row -> next word
        feedbackDiv.innerHTML = `<span style="color:green">ğŸ‰ Completed 3 correct attempts. Next word.</span>`;
        speakText("Excellent. Next word.");
        setTimeout(()=> pickNextWord(), 700);
        return;
      }
    }
  }

  // If typed is non-empty and not a prefix of correct -> it's a wrong attempt
  if(typed.length > 0 && !correct.startsWith(typed)){
    // mark wrong, reset streak
    madeWrongAttempt = true;
    correctStreak = 0;
    practiceInput.value = "";
    practiceInput.style.borderColor = '#c0392b';
    feedbackDiv.innerHTML = `<span style="color:#c0392b">âŒ Incorrect â€” Attempts now require 3 correct typings. Spelling will be spoken.</span>`;
    // Speak spelling and then the word
    setTimeout(()=> spellOut(currentPracticeWord), 200);
    setTimeout(()=> speakText("Now try typing the correct word three times."), 1000);
    return;
  }

  // Partial prefix (still typing) - encourage user
  feedbackDiv.innerText = `Keep typing...`;
  practiceInput.style.borderColor = '#3498db';
}

/* Hook events */
nextBtn.addEventListener('click', pickNextWord);
listenBtn.addEventListener('click', ()=> { if(currentPracticeWord) speakText(currentPracticeWord); else pickNextWord(); });
spellBtn.addEventListener('click', ()=> spellOut(currentPracticeWord));
practiceInput.addEventListener('input', onUserTyped);
practiceInput.addEventListener('keydown', onUserTyped);

/* Start first word automatically */
pickNextWord();

/* ------------- Other features: minimal OCR + Reader (kept as earlier) ------------- */

if(typeof pdfjsLib !== "undefined"){
  pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";
}

let currentPdf = null, totalPdfPages = 0;

async function processFile(){
  const f = document.getElementById('fileInput').files[0];
  const out = document.getElementById('doc-output');
  if(!f){ out.innerText = "Select a file."; return; }
  out.innerText = "Processing...";
  if(f.type === 'application/pdf'){
    try{
      const ab = await f.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({data:ab}).promise;
      currentPdf = pdf; totalPdfPages = pdf.numPages;
      document.getElementById('pdf-controls').style.display = 'block';
      displayPage(1);
    }catch(e){ out.innerText = "PDF read error."; }
  } else if(f.type.startsWith('image/')){
    try{
      const worker = Tesseract.createWorker({ logger: m => console.log(m) });
      await worker.load();
      await worker.loadLanguage('eng+hin+guj');
      await worker.initialize('eng+hin+guj');
      const { data: { text } } = await worker.recognize(f);
      await worker.terminate();
      out.innerText = text || "No text recognized.";
      autoReadAfterOCRIfWanted(text || "");
    }catch(e){
      out.innerText = "OCR failed.";
    }
  } else {
    out.innerText = "Unsupported file.";
  }
}

async function displayPage(p){
  const out = document.getElementById('doc-output');
  if(!currentPdf) return;
  try{
    const page = await currentPdf.getPage(p);
    const content = await page.getTextContent();
    const pageText = content.items.map(i => i.str).join(' ');
    out.innerText = pageText || `Page ${p} seems empty.`;
    document.getElementById('pageInfo').innerText = `Page ${p} of ${totalPdfPages}`;
    document.getElementById('pageNumberInput').value = p;
    autoReadAfterOCRIfWanted(pageText || "");
  }catch(e){
    out.innerText = "Error reading page.";
  }
}

function handleGoToPage(){
  const n = parseInt(document.getElementById('pageNumberInput').value || "1", 10);
  if(currentPdf) displayPage(n);
}

/* Language detect for OCR reading */
function detectLanguage(text){
  if(/[\u0A80-\u0AFF]/.test(text)) return 'gu-IN';
  if(/[\u0900-\u097F]/.test(text)) return 'hi-IN';
  if(/[A-Za-z]/.test(text)) return 'en-IN';
  return 'en-IN';
}

/* speak long text (simple) */
function speakLongText(text, lang){
  if(!('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang || 'en-IN';
  u.rate = (u.lang === 'en-IN') ? 0.95 : 0.9;
  window.speechSynthesis.speak(u);
}

document.getElementById('readDoc').addEventListener('click', ()=>{
  const text = document.getElementById('doc-output').innerText || '';
  if(!text.trim()){ document.getElementById('readStatus').innerText = 'No text to read.'; return; }
  const forced = document.getElementById('forceLang').value;
  const lang = forced || detectLanguage(text);
  speakLongText(text, lang);
});

document.getElementById('stopRead').addEventListener('click', ()=> { if('speechSynthesis' in window) window.speechSynthesis.cancel(); });

async function autoReadAfterOCRIfWanted(text){
  if(!text || !text.trim()) return;
  const auto = document.getElementById('autoLang').checked;
  const forced = document.getElementById('forceLang').value;
  if(!auto && !forced) return;
  const lang = forced || detectLanguage(text);
  setTimeout(()=> speakLongText(text, lang), 300);
}

/* Simple games hooks (kept minimal to save space) */
document.getElementById('hand-cricket-btn').addEventListener('click', ()=> {
  const el = document.getElementById('hand-cricket'); el.style.display = el.style.display==='none'?'block':'none';
});
let hcRuns=0, hcBalls=0, hcOut=false;
document.getElementById('hc-play').addEventListener('click', ()=>{
  const v = parseInt(document.getElementById('hc-input').value,10);
  const comp = Math.floor(Math.random()*7);
  if(isNaN(v) || v<0 || v>6){ speakText('Enter number 0 to 6'); return; }
  if(hcOut){ speakText('You are out. Reset.'); return; }
  hcBalls++;
  if(v===comp){ hcOut=true; const msg=`OUT! ${hcRuns} runs in ${hcBalls} balls`; document.getElementById('hc-status').innerText=msg; speakText(msg); }
  else { hcRuns += v; const msg=`You ${v}, Comp ${comp}. Runs ${hcRuns}`; document.getElementById('hc-status').innerText=msg; speakText(msg); }
});
document.getElementById('hc-reset').addEventListener('click', ()=>{ hcRuns=0; hcBalls=0; hcOut=false; document.getElementById('hc-status').innerText='Ready'; });

document.getElementById('snl-btn').addEventListener('click', ()=>{ const el=document.getElementById('snl'); el.style.display = el.style.display==='none'?'block':'none'; });
let snlPos=0; const snakes={16:6,24:9}, ladders={2:14,7:22};
document.getElementById('snl-roll').addEventListener('click', ()=>{ const d=Math.floor(Math.random()*6)+1; let next=snlPos+d; if(next>30) next=snlPos; snlPos=next; if(ladders[snlPos]) snlPos = ladders[snlPos]; if(snakes[snlPos]) snlPos = snakes[snlPos]; document.getElementById('snl-dice').innerText=d; document.getElementById('snl-status').innerText=`Moved to ${snlPos}`; speakText(`Moved to ${snlPos}`); });
document.getElementById('snl-reset').addEventListener('click', ()=>{ snlPos=0; document.getElementById('snl-status').innerText='Ready'; });

document.getElementById('ludo-btn').addEventListener('click', ()=>{ const el=document.getElementById('ludo'); el.style.display = el.style.display==='none'?'block':'none'; });
let you=0, comp=0;
document.getElementById('ludo-roll').addEventListener('click', ()=>{ const d1=Math.floor(Math.random()*6)+1, d2=Math.floor(Math.random()*6)+1; you+=d1; comp+=d2; document.getElementById('ludo-scores').innerText=`You ${you} Comp ${comp}`; speakText(`You ${you}, Computer ${comp}`); });
document.getElementById('ludo-reset').addEventListen