<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Chirag Rakani ‚Äî Accessible Tools Hub</title>
<meta name="description" content="Typing practice, document reader (PDF+OCR), location, accessible games ‚Äî by Chirag Rakani">
<link rel="icon" href="data:;base64,iVBORw0KGgo=">

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';</script>

<style>
  :root{
    --bg:#f1f5f9; --card:#fff; --accent:#123; --accent2:#1464ff; --ok:#2ea44f; --err:#c92a2a;
    --muted:#6b7280; font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#111;padding-bottom:40px;}
  
  /* Responsive Header */
  header{
    background:linear-gradient(90deg,#123,#165);color:#fff;
    padding:16px;
    display:flex; flex-wrap: wrap; align-items:center; gap:16px;
  }
  header h1{margin:0;font-size:1.2rem;line-height:1.4;}
  .logo-box{
    width:50px;height:50px;border-radius:10px;background:#fff;color:var(--accent);
    display:flex;align-items:center;justify-content:center;font-weight:800;flex-shrink:0;
  }
  
  .container{max-width:1150px;margin:20px auto;padding:0 16px;}
  
  /* Responsive Layout: Grid on Desktop, Stack on Mobile */
  .layout{
    display:grid;
    grid-template-columns: 340px 1fr;
    gap:18px;
  }
  
  /* Mobile Breakpoint */
  @media (max-width: 850px) {
    .layout { grid-template-columns: 1fr; }
    header { text-align:center; justify-content:center; }
    .controls { justify-content: center; }
  }

  .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 8px 24px rgba(15,23,42,0.06); overflow-wrap: break-word;}
  h2{margin:0 0 10px 0; font-size: 1.3rem;}
  .small{font-size:0.9rem;color:var(--muted); line-height: 1.5;}
  
  /* Interactive Elements */
  .btn{background:var(--accent2);color:#fff;border:0;padding:12px 16px;border-radius:8px;cursor:pointer;font-weight:600; font-size:0.95rem; touch-action: manipulation;}
  .btn:active{opacity:0.8;}
  .btn-alt{background:#0ea5ff}
  .btn-plain{background:#eef2ff;color:#123;border:1px solid #dbeafe}
  
  input[type="text"], input[type="number"], textarea, select{
    padding:12px;border-radius:8px;border:1px solid #e6eef8;
    width:100%;font-size:1rem; margin-bottom: 5px;
  }
  
  /* Flex Utils */
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px;}
  .flex-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  
  .output{background:#fbfdff;border:1px solid #e6eef8;padding:12px;border-radius:8px;min-height:140px;white-space:pre-wrap;overflow:auto; max-height: 400px;}
  
  footer{padding:14px;text-align:center;color:var(--muted);margin-top:20px; font-size: 0.9rem;}
  
  .diag-row{display:flex;justify-content:space-between;padding:8px;border-radius:6px;background:#f8fafc;margin-bottom:8px}
  
  .games-grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:10px;}
  .games-grid .btn { width: 100%; text-align: center; }

  code.k{background:#eef2ff;padding:2px 6px;border-radius:6px;color:#123}
  .note{background:#fffbe6;padding:10px;border-radius:8px;border:1px solid #f0e6b8; text-align:center;}

  /* Typing Section Specifics */
  .typing-area { display:flex; flex-direction:column; gap:10px; margin-bottom:10px; }
  @media(min-width: 600px){
    .typing-area { flex-direction:row; align-items:center; }
  }

  /* Diagnostics links */
  .link-list a { display: inline-block; margin-right: 10px; margin-bottom: 5px; color: var(--accent2); text-decoration: none;}
</style>
</head>
<body>
  <header>
    <div class="logo-box">CR</div>
    <div>
      <h1>Accessible Tools Hub</h1>
      <div class="small">Typing ‚Ä¢ OCR ‚Ä¢ Read ‚Ä¢ Location ‚Ä¢ Games</div>
    </div>
  </header>

  <main class="container">
    <div class="layout">
      
      <aside class="card" aria-label="Diagnostics and links">
        <h2>Diagnostics & Settings</h2>
        <div class="diag-row"><div>Speech Synthesis</div><div id="diag-speech">‚Äî</div></div>
        <div class="diag-row"><div>Geolocation</div><div id="diag-geo">‚Äî</div></div>
        <div class="diag-row"><div>OCR Engine</div><div id="diag-tess">Not loaded</div></div>
        <div style="margin-top:10px">
          <button id="btn-init" class="btn" style="width:100%">INITIALIZE AUDIO SYSTEM</button>
        </div>

        <hr style="margin:16px 0; border:0; border-top:1px solid #eee;">

        <h3>About / Links</h3>
        <p class="small link-list">
          <strong>Chirag Rakani</strong><br>
          <a href="mailto:chiragrakani6@gmail.com">Email Me</a>
          <a href="https://amzn.to/48Tnv7r" target="_blank">Amazon Link</a>
          <a href="https://www.amazon.in/dp/B0FXBS6X6Z/?tag=chiragrakani9-21" target="_blank">My Book</a><br>
          <a href="https://www.facebook.com/share/1DH4fAcwqU/" target="_blank">Facebook</a>
          <a href="https://www.instagram.com/koli.chirag" target="_blank">Instagram</a>
          <a href="https://youtube.com/shorts/Us4sDykOYtc" target="_blank">YouTube</a>
        </p>
      </aside>

      <section>
        
        <section class="card" id="typing-card" aria-labelledby="typing-h">
          <h2 id="typing-h">Typing Practice</h2>
          <p class="small">Rules: Type correctly ‚Üí Auto Next. Wrong ‚Üí Type 3 times correctly. <code class="k">F2</code> to spell.</p>

          <div class="typing-area">
            <div style="flex:1">
              <div id="practiceWord" class="note" style="font-weight:700;font-size:1.1rem">Press Next to start</div>
            </div>
            <div style="flex:1; min-width: 200px;">
              <input id="practiceInput" type="text" placeholder="Type here..." aria-label="Type the word here" autocomplete="off">
            </div>
          </div>

          <div class="controls">
            <button id="nextWordBtn" class="btn">üîÑ Next</button>
            <button id="listenBtn" class="btn">üîä Listen</button>
            <button id="spellBtn" class="btn btn-alt">üî° Spell</button>
            <div id="spellFeedback" class="small" style="font-weight:700; width:100%; margin-top:5px;"></div>
          </div>
        </section>

        <section class="card" style="margin-top:14px" aria-labelledby="doc-h">
          <h2 id="doc-h">Document Reader (OCR/PDF)</h2>
          <p class="small">Upload Image (JPG/PNG) or PDF.</p>

          <div class="flex-row" style="margin-bottom:8px">
            <input id="fileInput" type="file" accept="image/*,.pdf" style="width:auto; flex:1">
            <button id="processBtn" class="btn">Process File</button>
          </div>

          <div id="pdf-controls" style="display:none;" class="flex-row">
            <label class="small">Page: <input id="pageNumberInput" type="number" min="1" value="1" style="width:60px;display:inline-block"></label>
            <button id="goPageBtn" class="btn btn-plain" style="padding:8px 12px">Go</button>
            <span id="pageInfo" class="small"></span>
          </div>

          <div class="output" id="doc-output" tabindex="0" aria-live="polite">Text will appear here...</div>

          <div class="controls" style="margin-top:12px; align-items: flex-end;">
            <div style="flex:1; min-width: 150px;">
               <label class="small"><input id="autoLang" type="checkbox" checked> Auto Language</label><br>
               <select id="forceLang" style="margin-top:4px"><option value="">Detect</option><option value="en-IN">English</option><option value="hi-IN">Hindi</option><option value="gu-IN">Gujarati</option></select>
            </div>
            <div>
                <button id="readDocBtn" class="btn">üîä Read Aloud</button>
                <button id="stopReadBtn" class="btn btn-plain">‚èπ Stop</button>
            </div>
          </div>
          <div id="readStatus" class="small" style="margin-top:5px; color:var(--accent2)"></div>
        </section>

        <section class="card" style="margin-top:14px">
          <h2>Where Am I?</h2>
          <div class="flex-row">
            <button id="locBtn" class="btn">üìç Get Location</button>
            <div id="locOutput" class="small" style="flex:1"></div>
          </div>
        </section>

        <section class="card" style="margin-top:14px">
          <h2>Games</h2>
          <div class="games-grid">
            <button class="btn" onclick="window.open('https://lichess.org','_blank')">‚ôüÔ∏è Chess</button>
            <button id="handBtn" class="btn">üèè Cricket</button>
            <button id="snlBtn" class="btn">üé≤ Snakes</button>
            <button id="ludoBtn" class="btn">üéØ Ludo</button>
          </div>

          <div id="handPanel" style="display:none;margin-top:12px; background:#f8fafc; padding:10px; border-radius:8px;">
            <div class="small" id="hcStatus" style="font-weight:bold; margin-bottom:5px">Ready</div>
            <div class="flex-row">
              <input id="hcInput" type="number" min="0" max="6" placeholder="0-6" style="width:80px">
              <button id="hcPlay" class="btn">Play</button>
              <button id="hcReset" class="btn btn-plain">Reset</button>
            </div>
          </div>

          <div id="snlPanel" style="display:none;margin-top:12px; background:#f8fafc; padding:10px; border-radius:8px;">
            <div class="small" id="snlStatus" style="font-weight:bold; margin-bottom:5px">Ready</div>
            <div class="flex-row">
              <button id="snlRoll" class="btn">Roll Dice</button>
              <div id="snlDice" style="font-size:1.5rem; font-weight:bold; padding:0 10px">-</div>
              <button id="snlReset" class="btn btn-plain">Reset</button>
            </div>
          </div>

          <div id="ludoPanel" style="display:none;margin-top:12px; background:#f8fafc; padding:10px; border-radius:8px;">
            <div class="small" id="ludoStatus" style="font-weight:bold; margin-bottom:5px">Ready</div>
            <div class="flex-row">
              <button id="ludoRoll" class="btn">Roll</button>
              <button id="ludoReset" class="btn btn-plain">Reset</button>
            </div>
             <div id="ludoScores" class="small" style="margin-top:5px"></div>
          </div>

        </section>
      </section>
    </div>
  </main>

  <footer>¬© 2025 Chirag Rakani</footer>

<script>
/* ---------------- Utility: speak wrapper ---------------- */
function canSpeak(){ return ('speechSynthesis' in window); }
function speakText(text, lang='en-IN', rate=0.95){
  if(!canSpeak()) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.rate = rate;
  window.speechSynthesis.speak(u);
}

/* ---------- Diagnostics setup ---------- */
document.getElementById('diag-speech').innerText = canSpeak() ? 'Yes' : 'No';
document.getElementById('diag-geo').innerText = ('geolocation' in navigator) ? 'Yes' : 'No';
document.getElementById('diag-pdf').innerText = (typeof pdfjsLib !== 'undefined') ? 'Yes' : 'No';

/* ---------- Initialization ---------- */
document.getElementById('btn-init').addEventListener('click', function(){
  // Unlock audio context for mobile browsers
  try{
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if(AudioCtx){
      const ctx = new AudioCtx();
      const b = ctx.createBuffer(1,1,ctx.sampleRate);
      const s = ctx.createBufferSource();
      s.buffer = b; s.connect(ctx.destination);
      if(s.start) s.start(0);
    }
    if(canSpeak()) { speakText('System initialized.'); }
    this.innerText = 'Initialized ‚úì'; this.disabled = true;
  }catch(e){ console.warn(e); }
});

/* =================== Typing Practice Logic =================== */
const practiceInput = document.getElementById('practiceInput');
const practiceWord = document.getElementById('practiceWord');
const nextWordBtn = document.getElementById('nextWordBtn');
const listenBtn = document.getElementById('listenBtn');
const spellBtn = document.getElementById('spellBtn');
const spellFeedback = document.getElementById('spellFeedback');

const words = [
  "accessibility","computer","keyboard","software","screenreader","braille","typing",
  "success","motivation","efficiency","communication","technology","challenge","dedication",
  "confidence","amazing","support","document","location","internet","navigation","paragraph",
  "proficiency","essential","accurate","experience","organization","solution","applicant",
  "objective","multilingual","approachable","customer","service","position","utilize","contribute","gujarat"
];

let currentWord = '';
let madeWrong = false;
let correctStreak = 0;

function loadNextWord(){
  madeWrong = false; correctStreak = 0;
  currentWord = words[Math.floor(Math.random() * words.length)];
  practiceWord.innerText = 'Word: ' + currentWord;
  spellFeedback.innerText = '';
  practiceInput.value = '';
  practiceInput.focus();
  speakText(currentWord);
}

function spellOut(word){
  if(!word) return;
  const spelled = word.toUpperCase().split('').join('. ');
  speakText('Spelling. ' + spelled);
  spellFeedback.innerText = 'Spelling: ' + word.toUpperCase().split('').join('-');
}

practiceInput.addEventListener('input', handleTyping);
practiceInput.addEventListener('keydown', (e) => {
    if(e.key === 'F2'){ e.preventDefault(); spellOut(currentWord); }
    if(e.key === 'Enter') handleEnter();
});
nextWordBtn.addEventListener('click', loadNextWord);
listenBtn.addEventListener('click', ()=> { if(!currentWord) loadNextWord(); else speakText(currentWord); });
spellBtn.addEventListener('click', ()=> spellOut(currentWord));

function handleEnter(){
    const typed = practiceInput.value.trim().toLowerCase();
    if(!currentWord) return;
    if(!madeWrong && typed === currentWord.toLowerCase()){
        speakText('Correct.'); loadNextWord();
    } else if (madeWrong) {
        if(typed === currentWord.toLowerCase()){
           correctStreak++;
           practiceInput.value = '';
           if(correctStreak >= 3) { speakText('Done.'); loadNextWord(); }
           else { speakText(`${correctStreak} of 3.`); spellFeedback.innerText = `${correctStreak}/3 correct.`; }
        } else {
            speakText('Wrong. Try again.');
        }
    }
}

function handleTyping(e){
  const typed = practiceInput.value.trim().toLowerCase();
  if(e.inputType === 'insertLineBreak') return; 
  if(!currentWord) return;

  if(typed === currentWord.toLowerCase() && !madeWrong){
      spellFeedback.innerHTML = '<span style="color:var(--ok)">Correct!</span>';
  } else if (typed.length > 0 && !currentWord.toLowerCase().startsWith(typed)){
    madeWrong = true; correctStreak = 0;
    practiceInput.value = '';
    spellFeedback.innerHTML = '<span style="color:var(--err)">Incorrect. Type 3 times.</span>';
    speakText('Incorrect.');
    setTimeout(()=> spellOut(currentWord), 1000);
  }
}

/* ================ Document Reader (PDF + OCR) ================ */
const fileInput = document.getElementById('fileInput');
const processBtn = document.getElementById('processBtn');
const docOutput = document.getElementById('doc-output');
const readStatus = document.getElementById('readStatus');
let pdfDoc = null, totalPdfPages = 0;
let tessWorker = null;

async function ensureTesseract(){
  if(tessWorker) return tessWorker;
  docOutput.innerText = 'Loading OCR...';
  if(typeof Tesseract === 'undefined'){
    await new Promise((res)=>{
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js';
        s.onload = res; document.head.appendChild(s);
    });
  }
  tessWorker = await Tesseract.createWorker();
  await tessWorker.setParameters({ user_defined_dpi: '96' }); // optimize
  await tessWorker.loadLanguage('eng+hin+guj');
  await tessWorker.initialize('eng+hin+guj');
  document.getElementById('diag-tess').innerText = 'Ready';
  return tessWorker;
}

processBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if(!file){ alert('Select a file'); return; }
  docOutput.innerText = 'Processing...';
  
  if(file.type === 'application/pdf'){
      const ab = await file.arrayBuffer();
      pdfDoc = await pdfjsLib.getDocument({ data: ab }).promise;
      totalPdfPages = pdfDoc.numPages;
      document.getElementById('pdf-controls').style.display = 'flex';
      document.getElementById('pageNumberInput').max = totalPdfPages;
      renderPdfPage(1);
  } else if(file.type.startsWith('image/')){
      try{
          await ensureTesseract();
          const { data: { text } } = await tessWorker.recognize(file);
          docOutput.innerText = text || 'No text found.';
      }catch(e){ docOutput.innerText = 'OCR Error: ' + e.message; }
  }
});

async function renderPdfPage(num){
    if(!pdfDoc) return;
    try {
        const p = await pdfDoc.getPage(num);
        const t = await p.getTextContent();
        docOutput.innerText = t.items.map(s => s.str).join(' ');
        document.getElementById('pageInfo').innerText = `/ ${totalPdfPages}`;
    } catch(e) { docOutput.innerText = 'Page error'; }
}
document.getElementById('goPageBtn').addEventListener('click', ()=> renderPdfPage(parseInt(document.getElementById('pageNumberInput').value)));

/* Text to Speech Implementation */
document.getElementById('readDocBtn').addEventListener('click', () => {
    const text = docOutput.innerText;
    const lang = document.getElementById('forceLang').value || detectLanguage(text);
    readStatus.innerText = 'Reading... (' + lang + ')';
    speakLongText(text, lang);
});

document.getElementById('stopReadBtn').addEventListener('click', () => {
    window.speechSynthesis.cancel();
    readStatus.innerText = 'Stopped.';
});

function detectLanguage(t){
    if(/[\u0A80-\u0AFF]/.test(t)) return 'gu-IN';
    if(/[\u0900-\u097F]/.test(t)) return 'hi-IN';
    return 'en-IN';
}

function speakLongText(text, lang){
    window.speechSynthesis.cancel();
    if(!text) return;
    
    // Chunking for long text (simple split by punctuation)
    const sentences = text.match( /[^.!?]+[.!?]+|[^.!?]+$/g ) || [text];
    let i = 0;
    
    function speakNext(){
        if(i >= sentences.length) { readStatus.innerText = 'Finished.'; return; }
        const u = new SpeechSynthesisUtterance(sentences[i].trim());
        u.lang = lang;
        u.rate = 1;
        u.onend = () => { i++; speakNext(); };
        u.onerror = () => { readStatus.innerText = 'Error reading.'; };
        window.speechSynthesis.speak(u);
    }
    speakNext();
}

/* ================ Geolocation ================ */
document.getElementById('locBtn').addEventListener('click', () => {
    const out = document.getElementById('locOutput');
    out.innerText = 'Locating...';
    navigator.geolocation.getCurrentPosition(
        (p) => { out.innerText = `Lat: ${p.coords.latitude.toFixed(4)}, Lon: ${p.coords.longitude.toFixed(4)}`; },
        (e) => { out.innerText = 'Permission denied or unavailable.'; }
    );
});

/* ================ Games Logic (Simplified) ================ */
// Toggle panels
['hand','snl','ludo'].forEach(game => {
    document.getElementById(game+'Btn').addEventListener('click', ()=>{
        ['handPanel','snlPanel','ludoPanel'].forEach(p => document.getElementById(p).style.display='none');
        document.getElementById(game+'Panel').style.display = 'block';
    });
});

// Hand Cricket
document.getElementById('hcPlay').addEventListener('click', ()=>{
    const user = parseInt(document.getElementById('hcInput').value);
    const cpu = Math.floor(Math.random()*7);
    const status = document.getElementById('hcStatus');
    if(isNaN(user) || user>6) { status.innerText = 'Enter 0-6'; return; }
    if(user === cpu) status.innerText = `Out! Both chose ${user}.`;
    else status.innerText = `You: ${user}, CPU: 