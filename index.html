<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chirag Rakani ‚Äî Accessible Tools & Games Hub</title>
  <meta name="description" content="Accessible tools by Chirag Rakani ‚Äî typing, OCR (PDF/Image), games, location & social links.">
  <meta name="theme-color" content="#2c3e50">

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

  <style>
    :root{--bg:#f4f7fb;--card:#fff;--accent:#2c3e50;--accent2:#27ae60;--muted:#666}
    *{box-sizing:border-box}
    body{margin:0;font-family:Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
    header{background:var(--accent);color:#fff;padding:14px 16px}
    .container{max-width:980px;margin:18px auto;padding:0 14px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:320px 1fr}}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h2{margin:0 0 8px 0}
    .small{font-size:0.95rem;color:var(--muted)}
    .btn{background:var(--accent2);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .btn-alt{background:#3b82f6}
    .output{background:#fafafa;padding:12px;border-radius:6px;border:1px solid #e6e6e6;min-height:120px;white-space:pre-wrap}
    .typing-controls{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    input[type="text"], input[type="number"], textarea{padding:10px;border-radius:6px;border:1px solid #ddd;width:100%}
    footer{padding:14px;text-align:center;color:var(--muted)}
    a.social{color:var(--accent);text-decoration:none;margin-right:8px}
    .danger{background:#c0392b}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div style="width:56px;height:56px;border-radius:10px;background:#fff;color:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700">CR</div>
      <div>
        <h1 style="font-size:1.05rem;margin:0">Chirag's Accessible Tools & Games Hub</h1>
        <div class="small">Typing practice ¬∑ OCR (PDF/Image) ¬∑ Games ¬∑ Location ¬∑ Social</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Sidebar -->
      <aside class="card">
        <h2>About Me</h2>
        <p class="small"><strong>Chirag Rakani</strong> ‚Äî Gharana, Kutch, Gujarat. I build accessible tools for visually impaired users. Fluent in Hindi, Gujarati & English.</p>

        <h3>Buy my books</h3>
        <p class="small">
          <a class="social" href="https://amzn.to/48Tnv7r" target="_blank" rel="noopener noreferrer">Amazon Link 1</a><br>
          <a class="social" href="https://www.amazon.in/dp/B0FXBS6X6Z/ref=cm_sw_r_as_gl_apa_gl_i_NFFK753K6FK4F891H3MT?linkCode=ml1&tag=chiragrakani9-21&linkId=c26819af71b220eee7166bcb96218d56" target="_blank" rel="noopener noreferrer">Amazon Book (Buy)</a>
        </p>

        <h3>Contact & Social</h3>
        <p class="small">üìû 9737796825<br>‚úâÔ∏è <a href="mailto:chiragrakani6@gmail.com">chiragrakani6@gmail.com</a></p>
        <div class="small">
          <a class="social" href="https://youtube.com/shorts/Us4sDykOYtc?si=ITbIS3l6enuNzF29" target="_blank">YouTube</a>
          <a class="social" href="https://www.facebook.com/share/1DH4fAcwqU/" target="_blank">Facebook</a>
          <a class="social" href="https://www.instagram.com/koli.chirag?igsh=cGNyaTIyNXQ1NWM2" target="_blank">Instagram</a>
        </div>
      </aside>

      <!-- Main content -->
      <section>
        <!-- Typing Practice -->
        <article class="card" id="typing-card">
          <h2>Typing Practice ‚Äî Endless Spelling</h2>
          <p class="small">If you get a word correct on the first try ‚Üí it automatically moves to the next word. If you type it wrongly once, you must type it correctly 3 times to move on. Press <strong>Spell</strong> to hear letter-by-letter.</p>

          <div id="practiceWord" style="padding:10px;border:1px solid #eee;border-radius:6px;background:#fbfff6;margin-bottom:8px">Press Next to start</div>

          <input id="practiceInput" type="text" placeholder="Type the word here" aria-label="Type the word here">

          <div class="typing-controls" style="margin-top:8px">
            <button id="nextWordBtn" class="btn">üîÑ Next</button>
            <button id="listenBtn" class="btn">üîä Listen</button>
            <button id="spellBtn" class="btn btn-alt">üî° Spell</button>
            <div id="spellFeedback" aria-live="assertive" style="font-weight:600;margin-left:8px"></div>
          </div>
        </article>

        <!-- Document Reader -->
        <article class="card" style="margin-top:12px">
          <h2>Document Reader (Image / PDF)</h2>
          <p class="small">Upload an image or PDF. For PDF use the page box to jump to any page number and press Go.</p>

          <input id="fileInput" type="file" accept="image/*, .pdf" style="margin-top:8px">
          <div style="margin-top:8px" class="typing-controls">
            <button id="processBtn" class="btn">üìÅ Process</button>
            <div id="pdf-controls" style="display:none;align-items:center">
              <label style="display:flex;align-items:center;gap:6px">Page:
                <input id="pageNumberInput" type="number" min="1" value="1" style="width:80px;padding:8px">
              </label>
              <button id="goPageBtn" class="btn">Go</button>
              <span id="pageInfo" class="small" style="margin-left:8px"></span>
            </div>
          </div>

          <h3 style="margin-top:12px">Result:</h3>
          <div id="doc-output" class="output" tabindex="0" aria-live="polite">Text will appear here...</div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <label><input id="autoLang" type="checkbox" checked> Auto-detect language</label>
            <label style="margin-left:6px">Force:
              <select id="forceLang" style="padding:8px">
                <option value="">Auto</option>
                <option value="en-IN">English</option>
                <option value="hi-IN">Hindi</option>
                <option value="gu-IN">Gujarati</option>
              </select>
            </label>
            <button id="readDoc" class="btn">üîä Read</button>
            <button id="stopRead" class="btn danger">‚èπ Stop</button>
            <div id="readStatus" class="small" style="margin-left:8px"></div>
          </div>
        </article>

        <!-- Location -->
        <article class="card" style="margin-top:12px">
          <h2>Where Am I? (Location)</h2>
          <p class="small">Tap the button and allow browser location permission.</p>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="locBtn" class="btn">üìç Get Current Location</button>
            <div id="locationOutput" class="small" style="margin-left:8px"></div>
          </div>
        </article>

        <!-- Games -->
        <article class="card" style="margin-top:12px">
          <h2>Games</h2>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn" onclick="window.open('https://lichess.org','_blank')">‚ôüÔ∏è Play Chess (Lichess)</button>

            <div>
              <button id="handBtn" class="btn">üèè Hand Cricket</button>
              <div id="handPanel" style="display:none;margin-top:8px">
                <div id="hcStatus" class="small">Ready</div>
                <input id="hcInput" type="number" min="0" max="6" placeholder="0-6" style="width:90px;margin-top:6px">
                <div style="margin-top:8px">
                  <button id="hcPlay" class="btn">Play</button>
                  <button id="hcReset" class="btn" style="background:#777">Reset</button>
                </div>
              </div>
            </div>

            <div>
              <button id="snlBtn" class="btn">üé≤ Snakes & Ladders</button>
              <div id="snlPanel" style="display:none;margin-top:8px">
                <div id="snlStatus" class="small">Ready</div>
                <div style="margin-top:8px">
                  <button id="snlRoll" class="btn">Roll</button>
                  <button id="snlReset" class="btn" style="background:#777">Reset</button>
                  <div id="snlDice" class="small" style="display:inline-block;margin-left:12px">-</div>
                </div>
                <div id="snlBoard" style="margin-top:8px"></div>
              </div>
            </div>

            <div>
              <button id="ludoBtn" class="btn">üéØ Ludo Race</button>
              <div id="ludoPanel" style="display:none;margin-top:8px">
                <div id="ludoStatus" class="small">Ready</div>
                <div style="margin-top:8px">
                  <button id="ludoRoll" class="btn">Roll</button>
                  <button id="ludoReset" class="btn" style="background:#777">Reset</button>
                </div>
                <div id="ludoScores" class="small" style="margin-top:8px"></div>
              </div>
            </div>

          </div>
        </article>

      </section>
    </div>
  </main>

  <footer>¬© 2025 Chirag Rakani ‚Äî Accessible Tools Hub</footer>

  <div id="ann" class="sr-only" aria-live="assertive"></div>

<script>
/* ==================== Utility: Speech ==================== */
function speak(text, lang='en-IN', rate=0.95){
  if(!('speechSynthesis' in window)) return;
  try{ window.speechSynthesis.cancel(); }catch(e){}
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.rate = rate;
  window.speechSynthesis.speak(u);
}

/* ==================== Typing Practice ==================== */
const words = [
  "accessibility","computer","keyboard","software","screenreader","braille","typing",
  "success","motivation","efficiency","communication","technology","challenge","dedication",
  "confidence","amazing","support","document","location","internet","navigation","paragraph",
  "proficiency","essential","accurate","experience","organization","solution","applicant",
  "objective","multilingual","approachable","customer","service","position","utilize","contribute","gujarat"
];

let curr = "";
let madeWrong = false;
let streak = 0;

const practiceInput = document.getElementById('practiceInput');
const practiceWord = document.getElementById('practiceWord');
const feedback = document.getElementById('spellFeedback');
const nextWordBtn = document.getElementById('nextWordBtn');
const listenBtn = document.getElementById('listenBtn');
const spellBtn = document.getElementById('spellBtn');

function nextWord(){
  madeWrong = false;
  streak = 0;
  curr = words[Math.floor(Math.random()*words.length)];
  practiceWord.innerText = "üîä Listen: " + curr;
  feedback.innerText = "Type the word.";
  practiceInput.value = "";
  practiceInput.focus();
  // speak after user action (we call on button click)
  setTimeout(()=> speak(curr), 200);
}

function spellOut(word){
  if(!word) return;
  const s = word.toUpperCase().split('').join('. ');
  speak("Spelling: " + s);
  feedback.innerText = `Spelling: ${word.toUpperCase().split('').join(' ¬∑ ')}`;
}

function onType(e){
  const typed = practiceInput.value.trim().toLowerCase();
  if(e.type === 'keydown'){
    if(e.key === 'F2'){ e.preventDefault(); spellOut(curr); return;}
    if(e.key === 'Enter'){ e.preventDefault();
      // allow enter to proceed only if conditions satisfied
      if(!madeWrong){
        if(typed === curr.toLowerCase()) nextWord();
        else { feedback.innerText = "Type the word correctly."; speak("Type the word correctly."); }
      } else {
        if(streak >= 3) nextWord();
        else { feedback.innerText = `Need ${3-streak} more correct attempt(s)`; speak(`Need ${3-streak} more correct attempts`); }
      }
      return;
    }
  }
  if(e.type !== 'input') return;
  if(!curr){ feedback.innerText = "Press Next to start."; return; }
  if(typed === curr.toLowerCase()){
    if(!madeWrong){
      // first attempt correct -> auto next
      feedback.innerHTML = '<span style="color:green">‚úÖ Correct ‚Äî next word.</span>';
      speak("Correct. Next word.");
      setTimeout(nextWord, 600);
      return;
    } else {
      // made wrong earlier -> need 3 correct typings
      streak++;
      practiceInput.value = "";
      if(streak >= 3){
        feedback.innerHTML = '<span style="color:green">üéâ Done 3 correct ‚Äî next word.</span>';
        speak("Excellent. Next word.");
        setTimeout(nextWord,700);
      } else {
        feedback.innerHTML = `<span style="color:green">‚úÖ Correct (${streak}/3). Type again.</span>`;
        speak(`Correct. ${streak} of 3.`);
      }
      return;
    }
  }
  // typed non-empty and not prefix -> wrong
  if(typed.length > 0 && !curr.toLowerCase().startsWith(typed)){
    madeWrong = true;
    streak = 0;
    practiceInput.value = "";
    feedback.innerHTML = `<span style="color:#c0392b">‚ùå Incorrect ‚Äî attempts reset. Listening spelling now.</span>`;
    setTimeout(()=> spellOut(curr), 200);
    setTimeout(()=> speak("Now type the correct word three times."), 1000);
    return;
  }
  // partial prefix
  feedback.innerText = `Keep typing...`;
}

// hooks
nextWordBtn.addEventListener('click', ()=>{ nextWord(); });
listenBtn.addEventListener('click', ()=>{ if(curr) speak(curr); else nextWord(); });
spellBtn.addEventListener('click', ()=> spellOut(curr));
practiceInput.addEventListener('input', onType);
practiceInput.addEventListener('keydown', onType);

// initialize first word only after user interacts to allow speech
// We call nextWord() after first Next click (user will click it).

/* ==================== OCR & PDF ==================== */
if(typeof pdfjsLib !== 'undefined') pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

let pdfDoc = null;
let totalPages = 0;

const fileInput = document.getElementById('fileInput');
const processBtn = document.getElementById('processBtn');
const docOutput = document.getElementById('doc-output');
const pdfControls = document.getElementById('pdf-controls');
const pageNumberInput = document.getElementById('pageNumberInput');
const goPageBtn = document.getElementById('goPageBtn');
const pageInfo = document.getElementById('pageInfo');

async function displayPdfPage(pageNum){
  if(!pdfDoc){ docOutput.innerText = 'No PDF loaded.'; return; }
  if(pageNum < 1 || pageNum > totalPages){ docOutput.innerText = 'Invalid page number.'; return; }
  docOutput.innerText = 'Loading page...';
  try{
    const page = await pdfDoc.getPage(pageNum);
    const txt = await page.getTextContent();
    const pageText = txt.items.map(i=>i.str).join(' ');
    docOutput.innerText = `--- PAGE ${pageNum} ---\n\n` + (pageText || `Page ${pageNum} seems empty.`);
    pageInfo.innerText = `Page ${pageNum} of ${totalPages}`;
  }catch(e){
    docOutput.innerText = 'Error reading page.';
  }
}

goPageBtn.addEventListener('click', ()=> {
  const n = parseInt(pageNumberInput.value || '1',10);
  if(pdfDoc) displayPdfPage(n);
});

processBtn.addEventListener('click', async ()=>{
  const f = fileInput.files[0];
  if(!f){ docOutput.innerText = 'Select a file first.'; return; }
  docOutput.innerText = 'Processing... (this may take a few seconds)';
  // PDF
  if(f.type === 'application/pdf'){
    try{
      const ab = await f.arrayBuffer();
      pdfDoc = await pdfjsLib.getDocument({data:ab}).promise;
      totalPages = pdfDoc.numPages;
      pdfControls.style.display = 'inline-flex';
      pageNumberInput.max = totalPages;
      displayPdfPage(1);
    }catch(e){
      console.error(e);
      docOutput.innerText = 'PDF read error.';
    }
    return;
  }
  // Image -> OCR
  if(f.type.startsWith('image/')){
    if(typeof Tesseract === 'undefined'){ docOutput.innerText = 'OCR library not loaded.'; return; }
    try{
      const worker = Tesseract.createWorker({ logger: m => console.log(m) });
      await worker.load();
      await worker.loadLanguage('eng+hin+guj');
      await worker.initialize('eng+hin+guj');
      const { data: { text } } = await worker.recognize(f);
      await worker.terminate();
      docOutput.innerText = text || 'No text recognized.';
      autoReadOCR(text || '');
    }catch(err){
      console.error(err);
      docOutput.innerText = 'OCR failed. Try a clearer image.';
    }
    return;
  }
  docOutput.innerText = 'Unsupported file type.';
});

/* ======== language detection & reading ======== */
function detectLang(text){
  if(!text) return 'en-IN';
  if(/[\u0A80-\u0AFF]/.test(text)) return 'gu-IN';
  if(/[\u0900-\u097F]/.test(text)) return 'hi-IN';
  if(/[A-Za-z]/.test(text)) return 'en-IN';
  return 'en-IN';
}

function speakLongText(text, lang){
  if(!('speechSynthesis' in window)){ document.getElementById('readStatus').innerText = 'Speech not supported.'; return; }
  const forced = document.getElementById('forceLang').value;
  const useLang = forced || lang || detectLang(text);
  document.getElementById('readStatus').innerText = `Reading (${useLang})...`;
  // chunk text (300 chars) to avoid long utterance issues
  const cleaned = text.replace(/\s+/g,' ').trim();
  const chunkSize = 300;
  const chunks = [];
  let i = 0;
  while(i < cleaned.length){
    let part = cleaned.slice(i, i + chunkSize);
    // try to cut at sentence
    const lastDot = Math.max(part.lastIndexOf('.'), part.lastIndexOf('?'), part.lastIndexOf('!'));
    if(lastDot > Math.floor(chunkSize * 0.4)){
      chunks.push(cleaned.slice(i, i + lastDot + 1).trim());
      i += lastDot + 1;
    } else {
      chunks.push(part.trim());
      i += chunkSize;
    }
  }
  let idx = 0;
  function playChunk(){
    if(idx >= chunks.length){ document.getElementById('readStatus').innerText = 'Read complete.'; return; }
    const u = new SpeechSynthesisUtterance(chunks[idx]);
    u.lang = useLang;
    u.rate = (useLang === 'en-IN')?0.95:0.9;
    u.onend = ()=>{ idx++; setTimeout(playChunk, 200); };
    u.onerror = ()=>{ idx++; setTimeout(playChunk, 200); };
    speechSynthesis.speak(u);
  }
  try{ speechSynthesis.cancel(); }catch(e){}
  playChunk();
}

document.getElementById('readDoc').addEventListener('click', ()=>{
  const text = docOutput.innerText || '';
  if(!text.trim()){ document.getElementById('readStatus').innerText = 'No text to read.'; return; }
  const lang = detectLang(text);
  speakLongText(text, lang);
});
document.getElementById('stopRead').addEventListener('click', ()=>{ try{ speechSynthesis.cancel(); }catch(e){} document.getElementById('readStatus').innerText = 'Stopped.'; });

function autoReadOCR(text){
  if(!text || !text.trim()) return;
  const auto = document.getElementById('autoLang').checked;
  const forced = document.getElementById('forceLang').value;
  if(!auto && !forced) return;
  const lang = forced || detectLang(text);
  setTimeout(()=> speakLongText(text, lang), 300);
}

/* ==================== Location ==================== */
const locBtn = document.getElementById('locBtn');
const locOut = document.getElementById('locationOutput');
locBtn.addEventListener('click', ()=>{
  locOut.innerText = 'Locating...';
  if(!navigator.geolocation){ locOut.innerText = 'Geolocation not supported.'; return; }
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat = pos.coords.latitude.toFixed(6);
    const lon = pos.coords.longitude.toFixed(6);
    const maps = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
    locOut.innerHTML = `Lat: ${lat}, Lon: ${lon} ‚Äî <a href="${maps}" target="_blank">Open in Google Maps</a>`;
  }, err=>{
    if(err.code === 1) locOut.innerText = 'Permission denied. Allow location in browser settings.';
    else if(err.code === 2) locOut.innerText = 'Position unavailable.';
    else if(err.code === 3) locOut.innerText =