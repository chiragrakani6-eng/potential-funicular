<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chirag Rakani Accessible Tools & Games Hub</title>
  <meta name="description" content="Accessible tools by Chirag Rakani typing OCR PDF/Image games location & social links">
  <meta name="theme-color" content="#2c3e50">

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

  <style>
    :root{--bg:#f4f7fb;--card:#fff;--accent:#2c3e50;--accent2:#27ae60;--muted:#666}
    *{box-sizing:border-box}
    body{margin:0;font-family:Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
    header{background:var(--accent);color:#fff;padding:14px 16px}
    .container{max-width:980px;margin:18px auto;padding:0 14px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:320px 1fr}}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h2{margin:0 0 8px 0}
    h3{margin:8px 0 6px 0}
    .small{font-size:0.95rem;color:var(--muted)}
    .btn{background:var(--accent2);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .btn-alt{background:#3b82f6}
    .output{background:#fafafa;padding:12px;border-radius:6px;border:1px solid #e6e6e6;min-height:120px;white-space:pre-wrap}
    .typing-controls{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    input[type="text"], input[type="number"], textarea, select{padding:10px;border-radius:6px;border:1px solid #ddd;width:100%}
    footer{padding:14px;text-align:center;color:var(--muted)}
    a.social{color:var(--accent);text-decoration:none;margin-right:8px}
    .danger{background:#c0392b}
    /* Typing specific styles */
    .typing-box{padding:10px;border:1px solid #eee;border-radius:6px;background:#fbfff6;margin-bottom:8px}
    #wpmText, #tutorTextDisplay{line-height:1.6;font-size:1.1rem;margin-bottom:8px;white-space: pre-wrap;}
    .highlight-current-tutor{background-color: yellow; padding: 2px 0; border-radius: 2px;}
    .highlight-typed-tutor-correct{color: green; font-weight: bold;}
    .highlight-typed-tutor-error{color: red; background-color: #fdd; font-weight: bold; padding: 1px 0;}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div style="width:56px;height:56px;border-radius:10px;background:#fff;color:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700">CR</div>
      <div>
        <h1 style="font-size:1.05rem;margin:0">Chirag's Accessible Tools & Games Hub</h1>
        <div class="small">Typing practice OCR PDF/Image Games Location Social</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <aside class="card">
        <h2>About Me</h2>
        
        <p class="small">
            **Chirag Rakani Gharana Kutch Gujarat** I am a highly motivated and detail-oriented individual with a strong passion for communication and problem-solving Seeking a role in chat support data entry or any typing-related position where I can utilize my exceptional typing skills and customer interaction experience to contribute to organizational success I completed my 12th Grade at Blind School Bhuj I am dedicated to creating accessible apps and games for the visually impaired and I am also an author with books available on Amazon.
        </p>
        

        <h3>Buy my books</h3>
        <p class="small">
          <a class="social" href="https://amzn.to/48Tnv7r" target="_blank" rel="noopener noreferrer">Amazon Link 1</a><br>
          <a class="social" href="https://www.amazon.in/dp/B0FXBS6X6Z/ref=cm_sw_r_as_gl_apa_gl_i_NFFK753K6FK4F891H3MT?linkCode=ml1&tag=chiragrakani9-21&linkId=c26819af71b220eee7166bcb96218d56" target="_blank" rel="noopener noreferrer">Amazon Book Buy</a>
        </p>

        <h3>Contact & Social</h3>
        <p class="small">üìû 9737796825<br>‚úâÔ∏è <a href="mailto:chiragrakani6@gmail.com">chiragrakani6@gmail.com</a></p>
        <div class="small">
          <a class="social" href="https://youtube.com/shorts/Us4sDykOYtc?si=ITbIS3l6enuNzF29" target="_blank">YouTube</a>
          <a class="social" href="https://www.facebook.com/share/1DH4fAcwqU/" target="_blank">Facebook</a>
          <a class="social" href="https://www.instagram.com/koli.chirag?igsh=cGNyaTIyNXQ1NWM2" target="_blank">Instagram</a>
        </div>
      </aside>

      <section>
        <article class="card" id="typing-tutor-card">
          <h2>Typing Tutor (Key Placement & Words)</h2>
          <div id="tutorPanel">
            <div id="tutorStatus" class="typing-box">Press Start Tutor to begin</div>
            <p id="tutorTextDisplay" style="white-space: pre-wrap;">Welcome to the Typing Tutor. Press Start to begin Exercise 1.</p>
            <input id="tutorInput" type="text" placeholder="Start typing the sequence/words shown above" aria-label="Typing Tutor Input" disabled>
          </div>
          <div class="typing-controls">
            <button id="tutorBtn" class="btn">‚ñ∂ Start Tutor</button>
          </div>
        </article>
        
        <article class="card" style="margin-top:12px" id="wpm-card">
          <h2>Typing WPM Test</h2>
          <p class="small">Type the highlighted text as fast and accurately as possible to calculate your WPM score.</p>
          
          <div id="wpmText" class="typing-box">Click Start WPM Test to load the paragraph</div>
          <input id="wpmInput" type="text" placeholder="Start typing here" aria-label="WPM Test Input" disabled>
          
          <div class="typing-controls">
            <button id="wpmStartBtn" class="btn">‚ñ∂ Start WPM Test</button>
            <div id="wpmResults" style="font-weight:600;margin-left:8px">WPM: 0 | Errors: 0 | Time: 0s</div>
          </div>
        </article>

        <article class="card" style="margin-top:12px" id="typing-card">
          <h2>Typing Practice Endless Spelling</h2>
          <p class="small">If you get a word correct on the first try ‚Üí it automatically moves to the next word If you type it wrongly once you must type it correctly 3 times to move on Use F2 to repeat spelling letter by letter and Double F2 to repeat the full word</p>

          <div id="practiceWord" class="typing-box">Loading practice word</div>

          <input id="practiceInput" type="text" placeholder="Type the word here" aria-label="Type the word here">

          <div class="typing-controls">
            <button id="nextWordBtn" class="btn">üîÑ Next</button>
            <button id="listenBtn" class="btn">üîä Listen Word</button>
            <button id="spellBtn" class="btn btn-alt">üî° Spell Letter by Letter</button>
            <div id="spellFeedback" aria-live="assertive" style="font-weight:600;margin-left:8px"></div>
          </div>
        </article>
        
        <article class="card" style="margin-top:12px">
          <h2>QR Code Generator</h2>
          <p class="small">Enter any text or URL to generate a scannable QR Code.</p>
          <input id="qrInput" type="text" placeholder="Enter text or URL" aria-label="QR Code Input">
          <div id="qrOutput" style="margin-top:8px"></div>
          <button id="qrGenerateBtn" class="btn">Generate QR</button>
        </article>

        <article class="card" style="margin-top:12px">
          <h2>Text to Speech</h2>
          <p class="small">Enter text and press Speak to hear it read aloud.</p>
          <textarea id="ttsInput" placeholder="Enter text to speak" rows="3"></textarea>
          <div class="typing-controls">
            <button id="ttsSpeakBtn" class="btn">üîä Speak</button>
          </div>
        </article>
        
        <article class="card" style="margin-top:12px">
          <h2>Translator (External Link)</h2>
          <p class="small">This uses Google Translate to open the translation in a new tab.</p>
          <textarea id="translateInput" placeholder="Enter text to translate" rows="3"></textarea>
          <div class="typing-controls">
            <div style="display:flex;gap:8px;width:100%">
              <select id="translateSource" style="width:50%">
                <option value="auto">Auto-detect</option>
                <option value="en">English</option>
                <option value="hi">Hindi</option>
                <option value="gu">Gujarati</option>
              </select>
              <select id="translateTarget" style="width:50%">
                <option value="hi">Hindi</option>
                <option value="en">English</option>
                <option value="gu">Gujarati</option>
              </select>
            </div>
            <button id="translateBtn" class="btn">Open Translation</button>
          </div>
          <div id="translateOutput" class="small" style="margin-top:8px"></div>
        </article>

        <article class="card" style="margin-top:12px">
          <h2>Document Reader Image / PDF</h2>
          <p class="small">Upload an image or PDF For PDF use the page box to jump to any page number and press Go</p>

          <input id="fileInput" type="file" accept="image/*, .pdf" style="margin-top:8px">
          <div style="margin-top:8px" class="typing-controls">
            <button id="processBtn" class="btn">üìÅ Process</button>
            <div id="pdf-controls" style="display:none;align-items:center">
              <label style="display:flex;align-items:center;gap:6px">Page:
                <input id="pageNumberInput" type="number" min="1" value="1" style="width:80px;padding:8px">
              </label>
              <button id="goPageBtn" class="btn">Go</button>
              <span id="pageInfo" class="small" style="margin-left:8px"></span>
            </div>
          </div>

          <h3 style="margin-top:12px">Result:</h3>
          <div id="doc-output" class="output" tabindex="0" aria-live="polite">Text will appear here</div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <label><input id="autoLang" type="checkbox" checked> Auto-detect language</label>
            <label style="margin-left:6px">Force:
              <select id="forceLang" style="padding:8px">
                <option value="">Auto</option>
                <option value="en-IN">English</option>
                <option value="hi-IN">Hindi</option>
                <option value="gu-IN">Gujarati</option>
              </select>
            </label>
            <button id="readDoc" class="btn">üîä Read</button>
            <button id="stopRead" class="btn danger">‚èπ Stop</button>
            <div id="readStatus" class="small" style="margin-left:8px"></div>
          </div>
        </article>

        <article class="card" style="margin-top:12px">
          <h2>Where Am I Location</h2>
          <p class="small">Tap the button and allow browser location permission</p>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="locBtn" class="btn">üìç Get Current Location</button>
            <div id="locationOutput" class="small" style="margin-left:8px"></div>
          </div>
        </article>

        <article class="card" style="margin-top:12px">
          <h2>Games</h2>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn" onclick="window.open('https://lichess.org','_blank')">‚ôüÔ∏è Play Chess Lichess</button>

            <div>
              <button id="handBtn" class="btn">üèè Hand Cricket</button>
              <div id="handPanel" style="display:none;margin-top:8px">
                <div id="hcStatus" class="small">Ready</div>
                <input id="hcInput" type="number" min="0" max="6" placeholder="0-6" style="width:90px;margin-top:6px">
                <div style="margin-top:8px">
                  <button id="hcPlay" class="btn">Play</button>
                  <button id="hcReset" class="btn" style="background:#777">Reset</button>
                </div>
              </div>
            </div>

            <div>
              <button id="snlBtn" class="btn">üé≤ Snakes & Ladders</button>
              <div id="snlPanel" style="display:none;margin-top:8px">
                <div id="snlStatus" class="small">Ready</div>
                <div style="margin-top:8px">
                  <button id="snlRoll" class="btn">Roll</button>
                  <button id="snlReset" class="btn" style="background:#777">Reset</button>
                  <div id="snlDice" class="small" style="display:inline-block;margin-left:12px">-</div>
                </div>
                <div id="snlBoard" style="margin-top:8px"></div>
              </div>
            </div>

            <div>
              <button id="ludoBtn" class="btn">üéØ Ludo Race</button>
              <div id="ludoPanel" style="display:none;margin-top:8px">
                <div id="ludoStatus" class="small">Ready</div>
                <div style="margin-top:8px">
                  <button id="ludoRoll" class="btn">Roll</button>
                  <button id="ludoReset" class="btn" style="background:#777">Reset</button>
                </div>
                <div id="ludoScores" class="small" style="margin-top:8px"></div>
              </div>
            </div>

          </div>
        </article>

      </section>
    </div>
  </main>

  <footer>¬© 2025 Chirag Rakani Accessible Tools Hub</footer>

  <div id="ann" class="sr-only" aria-live="assertive"></div>

<script>
/* ==================== Utility: Speech ==================== */
function speak(text, lang='en-IN', rate=0.95){
  if(!('speechSynthesis' in window)) return;
  try{ window.speechSynthesis.cancel(); }catch(e){}
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.rate = rate;
  window.speechSynthesis.speak(u);
}

/* ==================== Typing Practice (Endless Spelling - Original) ==================== */
const wordsWithUsage = {
    "accessibility": "We are designing this tool for better web accessibility", "computer": "I use the computer for all my data entry tasks", "keyboard": "My typing speed is fast because I use the keyboard efficiently", "software": "I am competent in using Microsoft Office software", "screenreader": "A screenreader is essential for navigating the internet", "braille": "I learned to read using the braille system in school", "typing": "I am seeking a typing related position", "success": "Success requires dedication and consistent practice", "motivation": "I have high motivation to learn new skills", "efficiency": "Typing proficiency ensures high efficiency", "communication": "Strong communication skills are needed for chat support", "technology": "Assistive technology helps visually impaired people work effectively", "challenge": "I enjoy solving puzzles and logical challenges", "dedication": "Dedication and consistent practice are important", "confidence": "My confidence in my skills is very high", "amazing": "This accessibility feature is truly amazing", "support": "I can provide excellent customer support", "document": "Please review the document before printing", "location": "I am trying to find my current location", "internet": "Internet access is required for online work", "navigation": "Website navigation must be simple and clear", "paragraph": "I will type the entire paragraph quickly", "proficiency": "I have high proficiency in multilingual communication", "essential": "Attention to detail is essential for data entry", "accurate": "I ensure fast and accurate typing", "experience": "I have customer interaction experience", "organization": "I wish to contribute to the organization's success", "solution": "The problem solving team found a perfect solution", "applicant": "The job applicant submitted a strong resume", "objective": "My career objective is to work in tech support", "multilingual": "I am fluent making me a multilingual candidate", "approachable": "I am a friendly and approachable person", "customer": "I focus on helping every customer resolve their issues", "service": "I am passionate about customer service", "position": "I am seeking a data entry position", "utilize": "I will utilize my skills effectively", "contribute": "I am eager to contribute to the team", "gujarat": "I am currently living in Gujarat", "make": "I want to make me happy"
};

const words = Object.keys(wordsWithUsage);

let curr = "";
let madeWrong = false;
let streak = 0;
let lastF2Press = 0;
const F2_TIMEOUT = 500;

const practiceInput = document.getElementById('practiceInput');
const practiceWord = document.getElementById('practiceWord');
const feedback = document.getElementById('spellFeedback');
const nextWordBtn = document.getElementById('nextWordBtn');
const listenBtn = document.getElementById('listenBtn');
const spellBtn = document.getElementById('spellBtn');

function nextWord(){
  madeWrong = false;
  streak = 0;
  curr = words[Math.floor(Math.random()*words.length)];
  let usage = wordsWithUsage[curr];

  practiceWord.innerText = `üîä Word ${curr} | üìñ Usage ${usage}`;
  feedback.innerText = "Word loaded Type the word";
  practiceInput.value = "";
  practiceInput.focus();

  speak(`The word is ${curr}`);
  setTimeout(() => speak(`Use in a sentence ${usage}`, 'en-IN', 0.8), 1500);
}

function spellOut(word){
  if(!word) return;
  const s = word.toUpperCase().split('').join(' ');
  speak("Spelling " + s);
  feedback.innerText = `Spelling ${word.toUpperCase().split('').join(' ¬∑ ')}`;
}

function onType(e){
  const typed = practiceInput.value.trim().toLowerCase();
  
  if(e.type === 'keydown'){
    if(e.key === 'F2'){ 
      e.preventDefault(); 
      const now = new Date().getTime();

      if (now - lastF2Press < F2_TIMEOUT) {
        speak(curr);
        feedback.innerText = `üîä Repeating full word ${curr}`;
        lastF2Press = 0;
      } else {
        spellOut(curr);
        lastF2Press = now;
      }
      return;
    }

    if(e.key === 'Enter'){ 
      e.preventDefault();
      
      if(!curr) { feedback.innerText = "Press Next to start"; speak("Press Next to start"); return; }
      const correctWord = curr.toLowerCase();
      
      if(typed === correctWord){
          if(!madeWrong) return; 

          streak++;
          practiceInput.value = "";
          
          if(streak >= 3){
              feedback.innerHTML = '<span style="color:green">üéâ Done 3 correct next word</span>';
              speak("Excellent Next word");
              setTimeout(nextWord,700);
          } else {
              feedback.innerHTML = `<span style="color:green">‚úÖ Correct ${streak}/3 Type again</span>`;
              speak(`Correct ${streak} of 3`);
          }
      } else {
          madeWrong = true;
          streak = 0;
          practiceInput.value = "";
          feedback.innerHTML = `<span style="color:#c0392b">‚ùå Incorrect attempts reset Listening spelling now</span>`;
          setTimeout(()=> spellOut(curr), 200);
          setTimeout(()=> speak("Now you must type the correct word three times"), 1000);
      }
      return;
    }
  }

  if(e.type !== 'input') return;
  if(!curr){ feedback.innerText = "Press Next to start"; return; }
  
  const correctWord = curr.toLowerCase();

  if(!madeWrong && typed === correctWord){
    feedback.innerHTML = '<span style="color:green">‚úÖ Correct next word</span>';
    speak("Correct Next word");
    setTimeout(nextWord, 600);
    return;
  }

  if(typed.length > 0 && !correctWord.startsWith(typed)){
    madeWrong = true;
    streak = 0;
    practiceInput.value = "";
    feedback.innerHTML = `<span style="color:#c0392b">‚ùå Incorrect attempts reset Listening spelling now</span>`;
    setTimeout(()=> spellOut(curr), 200);
    setTimeout(()=> speak("Now you must type the correct word three times"), 1000);
    return;
  }
  
  if(typed.length > 0) {
      feedback.innerText = madeWrong ? `Keep typing ${streak}/3 attempts done` : `Keep typing`;
  } else {
      feedback.innerText = madeWrong ? `Start typing The word is ${curr}` : `Type the word`;
  }
}

// hooks
nextWordBtn.addEventListener('click', nextWord);
listenBtn.addEventListener('click', ()=>{ if(curr) speak(curr); else nextWord(); });
spellBtn.addEventListener('click', ()=> spellOut(curr));
practiceInput.addEventListener('input', onType);
practiceInput.addEventListener('keydown', onType);

/* ==================== Typing Tutor (Updated Logic for Sequences) ==================== */
const tutorExercises = [
    // Phase 1: Home Row Drills (Drills are long sequences for repetition)
    { type: 'drill', name: 'Home Row Drill', instruction: 'Exercise 1: Home Row Keys. Press A your left hand little finger. Type this sequence 3 times: a s d f g h j k l ; ; l k j h g f d s a ', 
      sequence: 'a s d f g h j k l ; ; l k j h g f d s a a s d f g h j k l ; ; l k j h g f d s a a s d f g h j k l ; ; l k j h g f d s a ' },
    
    // Phase 2: Bottom Row Drills
    { type: 'drill', name: 'Bottom Row Drill', instruction: 'Exercise 2: Bottom Row Keys. Type the Bottom Row sequence: z x c v b n m , . / / . , m n b v c x z ',
      sequence: 'z x c v b n m , . / / . , m n b v c x z z x c v b n m , . / / . , m n b v c x z ' },

    // Phase 3: Upper Row Drills
    { type: 'drill', name: 'Upper Row Drill', instruction: 'Exercise 3: Upper Row Keys. Type the Upper Row sequence: q w e r t y u i o p [ ] \\ \\ ] [ p o i u y t r e w q ',
      sequence: 'q w e r t y u i o p [ ] \\ \\ ] [ p o i u y t r e w q q w e r t y u i o p [ ] \\ \\ ] [ p o i u y t r e w q ' },

    // Phase 4: Number Row Drills
    { type: 'drill', name: 'Number Row Drill', instruction: 'Exercise 4: Number Row Keys. Type the Number Row sequence: 1 2 3 4 5 6 7 8 9 0 - = = - 0 9 8 7 6 5 4 3 2 1 ',
      sequence: '1 2 3 4 5 6 7 8 9 0 - = = - 0 9 8 7 6 5 4 3 2 1 1 2 3 4 5 6 7 8 9 0 - = = - 0 9 8 7 6 5 4 3 2 1 ' },

    // Phase 5: All Keys Drill
    { type: 'drill', name: 'All Keys Mix Drill', instruction: 'Exercise 5: All Keys Mix. Type the mixed sequence: q z 1 a s d 2 3 f v 4 c 5 g r t 6 y 7 h 8 j 9 k 0 l p ; - / [ ] = \\ ',
      sequence: 'q z 1 a s d 2 3 f v 4 c 5 g r t 6 y 7 h 8 j 9 k 0 l p ; - / [ ] = \\ q z 1 a s d 2 3 f v 4 c 5 g r t 6 y 7 h 8 j 9 k 0 l p ; - / [ ] = \\ ' },
      
    // Phase 6: Home Row Words
    { type: 'word', name: 'Home Row Words', instruction: 'Exercise 6: Home Row Words (30+ words). Type these words: dad fad sad hash slash lass adds fall flag gas has lash had salad dash lads dallas all adds gas half dash glad salad fall as dad had ',
      sequence: 'dad fad sad hash slash lass adds fall flag gas has lash had salad dash lads dallas all adds gas half dash glad salad fall as dad had ' },

    // Phase 7: Upper Row Words
    { type: 'word', name: 'Upper Row Words', instruction: 'Exercise 7: Upper Row Words (30+ words). Type these words: quiet wire tree pure type put root your poor wire riot out top tour true were wet up oil pipe year open tear trip your out port power route ',
      sequence: 'quiet wire tree pure type put root your poor wire riot out top tour true were wet up oil pipe year open tear trip your out port power route ' },

    // Phase 8: Bottom Row Words
    { type: 'word', name: 'Bottom Row Words', instruction: 'Exercise 8: Bottom Row Words (30+ words). Type these words: zebra comma value vice bank nave men max cat base mix maze cover box zip calm back vice next man vex cut come mix zero ban cave ',
      sequence: 'zebra comma value vice bank nave men max cat base mix maze cover box zip calm back vice next man vex cut come mix zero ban cave ' },
    
    // Phase 9: Home + Upper Row Mix
    { type: 'word', name: 'Home & Upper Words', instruction: 'Exercise 9: Home and Upper Row Words. Type these mixed words: eight sad lady put ask you flow fire wire oil all hope truth youth glass father had was top try saw pop out as if get joy lad low ',
      sequence: 'eight sad lady put ask you flow fire wire oil all hope truth youth glass father had was top try saw pop out as if get joy lad low ' },

    // Phase 10: Home + Bottom Row Mix
    { type: 'word', name: 'Home & Bottom Words', instruction: 'Exercise 10: Home and Bottom Row Words. Type these mixed words: bad case sad man face slab bag lads have vast mix mass glad base calm has can save lab sad man all add and max axe base ',
      sequence: 'bad case sad man face slab bag lads have vast mix mass glad base calm has can save lab sad man all add and max axe base ' },
    
    // Phase 11: All Lines Words (Comprehensive Mix)
    { type: 'word', name: 'All Lines Mix Words', instruction: 'Exercise 11: Comprehensive Mix Words. Type these words: quality pizza seven jump quite brown lazy next quick fox six zero one two three four five nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen ',
      sequence: 'quality pizza seven jump quite brown lazy next quick fox six zero one two three four five nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen ' }
];

let currentTutorExIndex = 0;
let tutorCurrentSequence = '';
let tutorCurrentIndex = 0;
let tutorErrors = 0;
let isTutorActive = false;

const tutorStatus = document.getElementById('tutorStatus');
const tutorInput = document.getElementById('tutorInput');
const tutorBtn = document.getElementById('tutorBtn');
const tutorTextDisplay = document.getElementById('tutorTextDisplay');

function updateTutorTextDisplay() {
    const sequence = tutorCurrentSequence;
    const typedPart = sequence.substring(0, tutorCurrentIndex);
    const currentPart = sequence[tutorCurrentIndex] || '';
    const remainingPart = sequence.substring(tutorCurrentIndex + 1);

    let typedHtml = '';
    // This is a simple visual check, we'll rely on the keydown/input handler for logic
    for (let i = 0; i < typedPart.length; i++) {
        if (tutorInput.value.length > i && tutorInput.value[i] !== typedPart[i]) {
            typedHtml += `<span class="highlight-typed-tutor-error">${typedPart[i]}</span>`;
        } else {
            typedHtml += `<span class="highlight-typed-tutor-correct">${typedPart[i]}</span>`;
        }
    }

    const currentHtml = `<span class="highlight-current-tutor">${currentPart}</span>`;
    
    // Show only the correct typed portion and the remaining text
    tutorTextDisplay.innerHTML = `${typedHtml}${currentHtml}${remainingPart}`;
}

function startTutor() {
    isTutorActive = true;
    currentTutorExIndex = 0;
    tutorInput.value = '';
    tutorInput.disabled = false;
    tutorBtn.innerText = 'Stop Tutor';
    loadTutorExercise(currentTutorExIndex);
}

function stopTutor() {
    isTutorActive = false;
    tutorInput.disabled = true;
    tutorBtn.innerText = '‚ñ∂ Start Tutor';
    tutorStatus.innerText = '‡§ü‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§∞‡•Å‡§ï‡§æ ‡§π‡•Å‡§Ü ‡§π‡•à‡•§ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Start Tutor ‡§¶‡§¨‡§æ‡§è‡§Å‡•§';
    tutorTextDisplay.innerText = 'Welcome to the Typing Tutor. Press Start to begin Exercise 1.';
    speak('‡§ü‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§∞‡•Å‡§ï ‡§ó‡§Ø‡§æ‡•§');
}

function loadTutorExercise(index) {
    if (index >= tutorExercises.length) {
        tutorStatus.innerText = 'üéâ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü! ‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä 11 ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•Ç‡§∞‡•á ‡§ï‡§∞ ‡§≤‡§ø‡§è ‡§π‡•à‡§Ç‡•§';
        tutorTextDisplay.innerHTML = 'All Exercises Complete!';
        speak('‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü ‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•Ç‡§∞‡•á ‡§ï‡§∞ ‡§≤‡§ø‡§è ‡§π‡•à‡§Ç‡•§');
        isTutorActive = false;
        tutorInput.disabled = true;
        tutorBtn.innerText = 'Restart Tutor';
        return;
    }

    const exercise = tutorExercises[index];
    tutorCurrentSequence = exercise.sequence;
    tutorCurrentIndex = 0;
    tutorInput.value = '';
    tutorErrors = 0;
    tutorInput.focus();
    
    tutorStatus.innerText = `‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ${index + 1}/${tutorExercises.length}: ${exercise.name} - ${exercise.instruction}`;
    
    updateTutorTextDisplay();

    // The long initial spoken instruction
    speak(`‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ${index + 1} ‡§∂‡•Å‡§∞‡•Ç ${exercise.name}‡•§ ${exercise.instruction}`, 'hi-IN', 0.85);

    // Give a small cue for the first key after the main instruction
    setTimeout(() => {
        const firstChar = tutorCurrentSequence[0];
        speak(`‡§™‡§π‡§≤‡§æ ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§π‡•à ${firstChar}`, 'hi-IN', 1.0);
    }, 5000);
}

tutorInput.addEventListener('input', (e) => {
    if (!isTutorActive) return;

    const typedValue = tutorInput.value;
    const requiredChar = tutorCurrentSequence[tutorCurrentIndex];
    
    // Check if the typed length exceeds the required index, which only happens on an error
    if (typedValue.length > tutorCurrentIndex + 1) {
        // This is a case of extra characters being typed after an error was not fixed, we ignore it.
        tutorInput.value = typedValue.substring(0, tutorCurrentIndex + 1);
        return;
    }
    
    // Check if the newly typed character is correct
    const lastTypedChar = typedValue[tutorCurrentIndex];
    
    if (lastTypedChar === requiredChar) {
        // Correct character typed
        tutorCurrentIndex++;
        tutorInput.value = tutorCurrentSequence.substring(0, tutorCurrentIndex); // Auto-corrects the input visually
        
        if (tutorCurrentIndex === tutorCurrentSequence.length) {
            // Exercise complete
            tutorStatus.innerText = `‚úÖ ‡§∏‡§π‡•Ä! ${tutorExercises[currentTutorExIndex].name} ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü‡•§ ‡§ó‡§≤‡§§‡§ø‡§Ø‡§æ‡§Å: ${tutorErrors}‡•§ ‡§Ö‡§ó‡§≤‡•á ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡§∞ ‡§ú‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§`;
            speak(`‡§∏‡§π‡•Ä! ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü‡•§`, 'hi-IN');
            currentTutorExIndex++;
            setTimeout(() => loadTutorExercise(currentTutorExIndex), 1500);
            return;
        }

        // Speak the next key only if it's not a space
        const nextChar = tutorCurrentSequence[tutorCurrentIndex];
        if (nextChar !== ' ') {
            speak(`‡§Ö‡§ó‡§≤‡§æ ${nextChar}`, 'hi-IN', 1.2);
        } else {
            // If the next is a space, speak the next word's first character or word
            const nextWordMatch = tutorCurrentSequence.substring(tutorCurrentIndex + 1).match(/\S+/);
            if (nextWordMatch) {
                const nextWord = nextWordMatch[0];
                speak(nextWord, 'en-IN', 1.2); 
            }
        }
    } else {
        // Incorrect character typed (user made a mistake)
        tutorErrors++;
        tutorStatus.innerText = `‚ùå ‡§ó‡§º‡§≤‡§§! ‡§Ü‡§™‡§®‡•á '${lastTypedChar}' ‡§ü‡§æ‡§á‡§™ ‡§ï‡§ø‡§Ø‡§æ‡•§ ‡§∏‡§π‡•Ä ‡§Ö‡§ï‡•ç‡§∑‡§∞ '${requiredChar}' ‡§π‡•à‡•§`;
        
        // Revert input to the correct position (before the error)
        tutorInput.value = typedValue.substring(0, tutorCurrentIndex);

        speak(`‡§ó‡§º‡§≤‡§§! ‡§∏‡§π‡•Ä ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§π‡•à ${requiredChar}`, 'hi-IN');
    }

    updateTutorTextDisplay();
});

tutorBtn.addEventListener('click', ()=>{
    if(tutorBtn.innerText === 'Stop Tutor') {
        stopTutor();
    } else {
        startTutor();
    }
});


/* ==================== Typing WPM Test (New Tool) ==================== */
const wpmText = "The quick brown fox jumps over the lazy dog this is a test to check your typing speed and accuracy please type the words as fast as you can to get your words per minute score practice every day to increase your proficiency and efficiency in all data entry tasks";
let wpmStartTime;
let wpmWordIndex = 0;
let wpmWords = [];
let wpmErrors = 0;
let correctCharacters = 0; 
let fullTypedCharacters = 0; 

const wpmInput = document.getElementById('wpmInput');
const wpmTextDiv = document.getElementById('wpmText');
const wpmResultsDiv = document.getElementById('wpmResults');
const wpmStartBtn = document.getElementById('wpmStartBtn');

function calculateWPM() {
    if (!wpmStartTime) return { wpm: 0, accuracy: 0 };

    const timeElapsedSeconds = (new Date().getTime() - wpmStartTime) / 1000;
    const minutes = timeElapsedSeconds / 60;
    
    const netWPM = Math.round((correctCharacters / 5) / minutes);
    const accuracy = fullTypedCharacters > 0 ? ((correctCharacters / fullTypedCharacters) * 100).toFixed(1) : 0;
    
    return { wpm: netWPM, errors: wpmErrors, time: Math.floor(timeElapsedSeconds), accuracy: accuracy };
}

function resetWPMTest() {
    wpmWords = wpmText.split(' ');
    wpmWordIndex = 0;
    wpmErrors = 0;
    correctCharacters = 0; 
    fullTypedCharacters = 0; 
    wpmStartTime = null;
    wpmInput.value = '';
    wpmInput.disabled = false;
    wpmStartBtn.innerText = 'Restart WPM Test';
    wpmResultsDiv.innerText = 'WPM: 0 | Errors: 0 | Time: 0s';
    
    wpmTextDiv.innerHTML = `<span id="wpmCurrentWord" style="background-color: yellow; padding: 2px;">${wpmWords[0]}</span> ${wpmWords.slice(1).join(' ')}`;
    wpmInput.focus();
    speak("WPM test started Type the highlighted word");
}

function updateWPMDisplay() {
    const results = calculateWPM();
    wpmResultsDiv.innerText = `WPM: ${results.wpm} | Errors: ${results.errors} | Time: ${results.time}s | Acc: ${results.accuracy}%`;
}

function checkWPMInput(e) {
    if (!wpmStartTime) { wpmStartTime = new Date().getTime(); }
    
    const typedValue = wpmInput.value;
    const currentWord = wpmWords[wpmWordIndex];
    
    fullTypedCharacters = wpmWords.slice(0, wpmWordIndex).join(' ').length + (wpmWordIndex > 0 ? wpmWordIndex : 0); 
    fullTypedCharacters += typedValue.length; 

    // Check for word completion (space pressed after correct word)
    if (typedValue.endsWith(' ') && typedValue.trim() === currentWord) {
        
        correctCharacters += currentWord.length + 1; 

        wpmWordIndex++;
        wpmInput.value = '';
        
        if (wpmWordIndex < wpmWords.length) {
            const typedPart = `<span style="color: green">${wpmWords.slice(0, wpmWordIndex).join(' ')}</span>`;
            const after = wpmWords.slice(wpmWordIndex + 1).join(' ');
            
            wpmTextDiv.innerHTML = `${typedPart} <span id="wpmCurrentWord" style="background-color: yellow; padding: 2px;"> ${wpmWords[wpmWordIndex]}</span> ${after}`;
            
            speak(wpmWords[wpmWordIndex]);
        } else {
            finishWPMTest();
        }
    } else {
        const typedTrimmed = typedValue.trim();
        const currentWordSpan = document.getElementById('wpmCurrentWord');
        
        let localCorrectChars = 0;
        let html = '';

        for (let i = 0; i < currentWord.length; i++) {
            const char = currentWord[i];
            const typedChar = typedTrimmed[i];
            if (i < typedTrimmed.length) {
                if (char === typedChar) {
                    html += `<span style="color: green;">${char}</span>`;
                    localCorrectChars++;
                } else {
                    html += `<span style="color: red;">${char}</span>`;
                    if(e.inputType === 'insertText' && i === typedTrimmed.length - 1) {
                         wpmErrors++;
                    }
                }
            } else {
                html += char;
            }
        }
        
        if (currentWordSpan) {
             currentWordSpan.innerHTML = html;
        }

        correctCharacters = wpmWords.slice(0, wpmWordIndex).reduce((sum, word) => sum + word.length + 1, 0);
        correctCharacters += localCorrectChars;
    }
    
    updateWPMDisplay();
}

function finishWPMTest() {
    const results = calculateWPM();
    
    wpmInput.disabled = true;
    wpmInput.oninput = null;
    wpmTextDiv.innerHTML = `<span style="color: green">${wpmWords.join(' ')}</span>`;

    const finalResults = `Test Finished! WPM: ${results.wpm}. Errors: ${results.errors}. Time: ${results.time}s. Accuracy: ${results.accuracy}%.`;
    wpmResultsDiv.innerText = finalResults;
    speak(`Test finished Your words per minute is ${results.wpm} with ${results.accuracy} percent accuracy`);
    wpmStartTime = null;
}

wpmStartBtn.addEventListener('click', resetWPMTest);
wpmInput.addEventListener('input', checkWPMInput);


/* ==================== QR Code Generator (New Tool) ==================== */
document.getElementById('qrGenerateBtn').addEventListener('click', ()=>{
    const text = document.getElementById('qrInput').value.trim();
    const qrOutput = document.getElementById('qrOutput');
    
    if(!text){
        qrOutput.innerHTML = 'Enter text to generate QR code';
        speak('Enter text to generate QR code');
        return;
    }
    
    const encodedText = encodeURIComponent(text);
    const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=${encodedText}`;
    
    qrOutput.innerHTML = `<p>QR Code generated:</p><img src="${qrUrl}" alt="QR Code for ${text}" style="width:200px;height:200px;"><p><a href="${qrUrl}" target="_blank">View Image</a></p>`;
    speak('QR Code generated successfully');
});


/* ==================== Text to Speech (New Tool) ==================== */
document.getElementById('ttsSpeakBtn').addEventListener('click', ()=>{
    const text = document.getElementById('ttsInput').value;
    if(text){
        speak(text, 'en-IN', 1.0);
    } else {
        speak('Please enter text to speak');
    }
});


/* ==================== Translator (New Tool) ==================== */
document.getElementById('translateBtn').addEventListener('click', ()=>{
    const text = document.getElementById('translateInput').value.trim();
    if(!text){
        document.getElementById('translateOutput').innerText = 'Enter text to translate';
        speak('Enter text to translate');
        return;
    }
    
    const sourceLang = document.getElementById('translateSource').value;
    const targetLang = document.getElementById('translateTarget').value;
    
    const translateUrl = `https://translate.google.com/?sl=${sourceLang}&tl=${targetLang}&text=${encodeURIComponent(text)}&op=translate`;
    window.open(translateUrl, '_blank');
    
    document.getElementById('translateOutput').innerText = 'Opening translation result in a new tab...';
    speak('Opening translation result in a new tab');
});


/* ==================== OCR & PDF ==================== */
if(typeof pdfjsLib !== 'undefined') pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

let pdfDoc = null;
let totalPages = 0;

const fileInput = document.getElementById('fileInput');
const processBtn = document.getElementById('processBtn');
const docOutput = document.getElementById('doc-output');
const pdfControls = document.getElementById('pdf-controls');
const pageNumberInput = document.getElementById('pageNumberInput');
const goPageBtn = document.getElementById('goPageBtn');
const pageInfo = document.getElementById('pageInfo');

async function displayPdfPage(pageNum){
  if(!pdfDoc){ docOutput.innerText = 'No PDF loaded'; return; }
  if(pageNum < 1 || pageNum > totalPages){ docOutput.innerText = 'Invalid page number'; return; }
  docOutput.innerText = 'Loading page...';
  try{
    const page = await pdfDoc.getPage(pageNum);
    const txt = await page.getTextContent();
    const pageText = txt.items.map(i=>i.str).join(' ');
    
    const cleanedText = pageText.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
    
    docOutput.innerText = `--- PAGE ${pageNum} ---\n\n` + (cleanedText || `Page ${pageNum} seems empty`);
    pageInfo.innerText = `Page ${pageNum} of ${totalPages}`;
  }catch(e){
    docOutput.innerText = 'Error reading page';
  }
}

goPageBtn.addEventListener('click', ()=> {
  const n = parseInt(pageNumberInput.value || '1',10);
  if(pdfDoc) displayPdfPage(n);
});

processBtn.addEventListener('click', async ()=>{
  const f = fileInput.files[0];
  if(!f){ docOutput.innerText = 'Select a file first'; return; }
  docOutput.innerText = 'Processing (this may take a few seconds)';
  
  if(f.type === 'application/pdf'){
    try{
      const ab = await f.arrayBuffer();
      pdfDoc = await pdfjsLib.getDocument({data:ab, maxImageSize: 1024}).promise; 
      totalPages = pdfDoc.numPages;
      pdfControls.style.display = 'inline-flex';
      pageNumberInput.max = totalPages;
      displayPdfPage(1);
    }catch(e){
      console.error(e);
      docOutput.innerText = 'PDF read error';
    }
    return;
  }
  if(f.type.startsWith('image/')){
    if(typeof Tesseract === 'undefined'){ docOutput.innerText = 'OCR library not loaded'; return; }
    try{
      const worker = Tesseract.createWorker({ 
          logger: m => console.log(m),
          preserveInterwordSpaces: true 
      });
      await worker.load();
      await worker.loadLanguage('eng+hin+guj');
      await worker.initialize('eng+hin+guj');
      await worker.setParameters({
        tessedit_ocr_engine_mode: Tesseract.OEM.LSTM_ONLY,
        tessedit_pageseg_mode: Tesseract.PSM.AUTO 
      });
      
      const { data: { text } } = await worker.recognize(f);
      await worker.terminate();
      
      const cleanedText = text.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,""); 
      docOutput.innerText = cleanedText || 'No text recognized';
      autoReadOCR(cleanedText || '');
    }catch(err){
      console.error(err);
      docOutput.innerText = 'OCR failed Try a clearer image';
    }
    return;
  }
  docOutput.innerText = 'Unsupported file type';
});

/* ======== language detection & reading ======== */
function detectLang(text){
  if(!text) return 'en-IN';
  if(/[\u0A80-\u0AFF]/.test(text)) return 'gu-IN';
  if(/[\u0900-\u097F]/.test(text)) return 'hi-IN';
  if(/[A-Za-z]/.test(text)) return 'en-IN';
  return 'en-IN';
}

function speakLongText(text, lang){
  if(!('speechSynthesis' in window)){ document.getElementById('readStatus').innerText = 'Speech not supported'; return; }
  const forced = document.getElementById('forceLang').value;
  const useLang = forced || lang || detectLang(text);
  document.getElementById('readStatus').innerText = `Reading ${useLang}`;
  
  const cleaned = text.replace(/\s+/g,' ').trim();
  const chunkSize = 300;
  const chunks = [];
  let i = 0;
  while(i < cleaned.length){
    let part = cleaned.slice(i, i + chunkSize);
    let cutPoint = i + chunkSize;
    if (cleaned.length > i + chunkSize) {
        let lastSpace = cleaned.lastIndexOf(' ', i + chunkSize);
        if (lastSpace > i + chunkSize - 50) { 
            cutPoint = lastSpace;
        }
    }
    chunks.push(cleaned.slice(i, cutPoint).trim());
    i = cutPoint;
  }
  let idx = 0;
  function playChunk(){
    if(idx >= chunks.length){ document.getElementById('readStatus').innerText = 'Read complete'; return; }
    const u = new SpeechSynthesisUtterance(chunks[idx]);
    u.lang = useLang;
    u.rate = (useLang === 'en-IN')?0.95:0.9;
    u.onend = ()=>{ idx++; setTimeout(playChunk, 200); };
    u.onerror = ()=>{ idx++; setTimeout(playChunk, 200); };
    speechSynthesis.speak(u);
  }
  try{ speechSynthesis.cancel(); }catch(e){}
  playChunk();
}

document.getElementById('readDoc').addEventListener('click', ()=>{
  const text = docOutput.innerText || '';
  if(!text.trim()){ document.getElementById('readStatus').innerText = 'No text to read'; return; }
  const lang = detectLang(text);
  speakLongText(text, lang);
});
document.getElementById('stopRead').addEventListener('click', ()=>{ try{ speechSynthesis.cancel(); }catch(e){} document.getElementById('readStatus').innerText = 'Stopped'; });

function autoReadOCR(text){
  if(!text || !text.trim()) return;
  const auto = document.getElementById('autoLang').checked;
  const forced = document.getElementById('forceLang').value;
  if(!auto && !forced) return;
  const lang = forced || detectLang(text);
  setTimeout(()=> speakLongText(text, lang), 300);
}

/* ==================== Location ==================== */
const locBtn = document.getElementById('locBtn');
const locOut = document.getElementById('locationOutput');
locBtn.addEventListener('click', ()=>{
  locOut.innerText = 'Locating...';
  if(!navigator.geolocation){ locOut.innerText = 'Geolocation not supported by this browser'; return; }
  
  const options = {
    enableHighAccuracy: true,
    timeout: 10000, 
    maximumAge: 0
  };
  
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat = pos.coords.latitude.toFixed(6);
    const lon = pos.coords.longitude.toFixed(6);
    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
    locOut.innerHTML = `Lat ${lat} Lon ${lon} ‚Äî <a href="${mapsUrl}" target="_blank">Open in Google Maps</a>`;
    speak(`Location found Latitude ${lat} Longitude ${lon}`);
  }, err=>{
    let msg = 'An unknown error occurred';
    if(err.code === 1) msg = 'Permission denied Please allow location access in browser settings';
    else if(err.code === 2) msg = 'Position unavailable Unable to determine location';
    else if(err.code === 3) msg = 'Request timed out';
    
    locOut.innerText = `Error ${msg}`;
    speak(`Location error ${msg}`);
  }, options);
});

/* ==================== Games ==================== */
// Hand Cricket Logic
const hcStatus = document.getElementById('hcStatus');
const hcInput = document.getElementById('hcInput');
const hcPlay = document.getElementById('hcPlay');
const hcReset = document.getElementById('hcReset');
const handBtn = document.getElementById('handBtn');
const handPanel = document.getElementById('handPanel');

let hcTarget = 0;
let hcScore = 0;
let hcState = 'batting'; // 'batting' or 'bowling'

handBtn.addEventListener('click', ()=>{
    const isVisible = handPanel.style.display === 'block';
    handPanel.style.display = isVisible ? 'none' : 'block';
    if (!isVisible) resetHandCricket();
});

function resetHandCricket(){
    hcTarget = 0;
    hcScore = 0;
    hcState = 'batting';
    hcStatus.innerText = 'You are batting Enter a number 1-6 to score';
    hcInput.value = '';
    speak('Hand Cricket reset You are batting Enter a number 1 to 6');
}

hcReset.addEventListener('click', resetHandCricket);

hcPlay.addEventListener('click', ()=>{
    if(hcState === 'finished') { speak('Game finished Please reset'); return; }
    const playerRun = parseInt(hcInput.value);
    if (isNaN(playerRun) || playerRun < 1 || playerRun > 6) {
        hcStatus.innerText = 'Invalid input Enter a number between 1 and 6';
        speak('Invalid input');
        return;
    }

    const computerRun = Math.floor(Math.random() * 6) + 1;
    hcInput.value = '';

    if (hcState === 'batting') {
        if (playerRun === computerRun) {
            hcTarget = hcScore + 1;
            hcScore = 0; 
            hcState = 'bowling';
            hcStatus.innerText = `Out You played ${playerRun} Computer bowled ${computerRun} Your total score is ${hcTarget - 1} Now computer is batting You are bowling Computer needs ${hcTarget} to win`;
            speak(`Out Your score is ${hcTarget - 1} Computer needs ${hcTarget} to win You are bowling Enter a number 1 to 6`);
        } else {
            hcScore += playerRun;
            hcStatus.innerText = `You scored ${playerRun} Computer bowled ${computerRun} Total score ${hcScore}`;
            speak(`You scored ${playerRun} Total score ${hcScore}`);
        }
    } else if (hcState === 'bowling') {
        if (playerRun === computerRun) {
            const runDiff = Math.abs(hcTarget - 1 - hcScore);
            
            if (hcScore < hcTarget - 1) {
                hcStatus.innerText = `Out Computer played ${computerRun} You bowled ${playerRun} Computer score ${hcScore} Target was ${hcTarget - 1} You won by ${runDiff} runs`;
                speak(`Out Computer score ${hcScore} You won by ${runDiff} runs`);
            } else {
                
                hcStatus.innerText = `Out Computer played ${computerRun} You bowled ${playerRun} Computer score ${hcScore} Target was ${hcTarget - 1} It was a tie. Game over.`;
                speak(`It was a tie. Game over.`);
            }

            hcState = 'finished';

        } else {
            hcScore += computerRun;
            if (hcScore >= hcTarget) {
                hcStatus.innerText = `Computer scored ${computerRun} Total computer score ${hcScore} Target was ${hcTarget} Computer won`;
                speak(`Computer won with score ${hcScore}`);
                hcState = 'finished';
            } else {
                const required = hcTarget - hcScore;
                hcStatus.innerText = `Computer scored ${computerRun} Total computer score ${hcScore} Computer needs ${required} more runs to win`;
                speak(`Computer scored ${computerRun} Needs ${required} more runs`);
            }
        }
    }
});

// Snakes & Ladders (Simplified)
const snlStatus = document.getElementById('snlStatus');
const snlRoll = document.getElementById('snlRoll');
const snlReset = document.getElementById('snlReset');
const snlDice = document.getElementById('snlDice');
const snlBtn = document.getElementById('snlBtn');
const snlPanel = document.getElementById('snlPanel');

let snlPosition = 1;
const snlJumps = {
    4: 14, 9: 31, 20: 38, 28: 84, 40: 59, 63: 81, 71: 91, // Ladders
    17: 7, 54: 34, 62: 19, 64: 60, 87: 24, 93: 73, 95: 75, 98: 78 // Snakes
};

snlBtn.addEventListener('click', ()=>{
    const isVisible = snlPanel.style.display === 'block';
    snlPanel.style.display = isVisible ? 'none' : 'block';
    if (!isVisible) resetSnakesLadders();
});

function resetSnakesLadders(){
    snlPosition = 1;
    snlStatus.innerText = 'Your position is 1 Roll the dice to begin First to 100 wins';
    snlDice.innerText = '-';
    speak('Snakes and Ladders reset Your position is 1');
}
snlReset.addEventListener('click', resetSnakesLadders);

snlRoll.addEventListener('click', ()=>{
    if(snlPosition >= 100) return;
    const roll = Math.floor(Math.random() * 6) + 1;
    snlDice.innerText = roll;
    
    let newPosition = snlPosition + roll;

    if (newPosition > 100) {
        snlStatus.innerText = `You rolled ${roll} but need exactly ${100 - snlPosition} to win You stay at ${snlPosition}`;
        speak(`You rolled ${roll} but cannot move`);
        return;
    }
    
    let jumpMsg = '';
    if (snlJumps[newPosition]) {
        const finalPosition = snlJumps[newPosition];
        if (finalPosition > newPosition) {
            jumpMsg = ` Wow a Ladder from ${newPosition} to ${finalPosition}`;
        } else {
            jumpMsg = ` Oh no a Snake from ${newPosition} down to ${finalPosition}`;
        }
        newPosition = finalPosition;
    }
    
    snlPosition = newPosition;

    if (snlPosition === 100) {
        snlStatus.innerText = `üéâ You rolled ${roll} and landed on 100 You win`;
        speak(`You rolled ${roll} and landed on 100 You win`);
        return;
    }
    
    snlStatus.innerText = `You rolled ${roll} Your new position is ${snlPosition}${jumpMsg}`;
    speak(`You rolled ${roll} New position ${snlPosition} ${jumpMsg}`);
});

// Ludo Race (Simplified one player vs three AI)
const ludoStatus = document.getElementById('ludoStatus');
const ludoRoll = document.getElementById('ludoRoll');
const ludoReset = document.getElementById('ludoReset');
const ludoScores = document.getElementById('ludoScores');
const ludoBtn = document.getElementById('ludoBtn');
const ludoPanel = document.getElementById('ludoPanel');

let ludoPositions = { player: 0, ai1: 0, ai2: 0, ai3: 0 };
const LUDO_END = 50;
let ludoTurn = 'player';
let ludoGameActive = true;

ludoBtn.addEventListener('click', ()=>{
    const isVisible = ludoPanel.style.display === 'block';
    ludoPanel.style.display = isVisible ? 'none' : 'block';
    if (!isVisible) resetLudo();
});

function resetLudo(){
    ludoPositions = { player: 0, ai1: 0, ai2: 0, ai3: 0 };
    ludoTurn = 'player';
    ludoGameActive = true;
    ludoStatus.innerText = 'Ludo Race reset First to 50 wins Your turn';
    updateLudoScores();
    speak('Ludo Race reset Your turn');
}
ludoReset.addEventListener('click', resetLudo);

function updateLudoScores(){
    ludoScores.innerHTML = `Player ${ludoPositions.player} | AI 1 ${ludoPositions.ai1} | AI 2 ${ludoPositions.ai2} | AI 3 ${ludoPositions.ai3}`;
}

function checkLudoWin(player){
    if (ludoPositions[player] >= LUDO_END) {
        ludoStatus.innerText = `${player.toUpperCase()} wins`;
        speak(`${player.toUpperCase()} wins`);
        ludoGameActive = false;
        return true;
    }
    return false;
}

function rollLudoDice(){
    return Math.floor(Math.random() * 6) + 1;
}

function handleAITurn(ai){
    if(!ludoGameActive) return;
    const roll = rollLudoDice();
    ludoPositions[ai] += roll;
    
    if (checkLudoWin(ai)) return;
    
    ludoStatus.innerText = `It was ${ai.toUpperCase()}'s turn They rolled ${roll} New position ${ludoPositions[ai]} Your turn`;
    updateLudoScores();
    speak(`${ai.toUpperCase()} rolled ${roll} Your turn`);
    
    if(ludoGameActive) ludoTurn = 'player';
}

ludoRoll.addEventListener('click', ()=>{
    if (!ludoGameActive || ludoTurn !== 'player') return;

    const roll = rollLudoDice();
    ludoPositions.player += roll;
    
    if (checkLudoWin('player')) return;

    ludoStatus.innerText = `You rolled ${roll} Your new position is ${ludoPositions.player}`;
    updateLudoScores();
    speak(`You rolled ${roll} Your new position is ${ludoPositions.player}`);

    ludoTurn = 'ai1';
    setTimeout(() => handleAITurn('ai1'), 1500);
    setTimeout(() => { if(ludoGameActive) handleAITurn('ai2'); }, 3000);
    setTimeout(() => { if(ludoGameActive) handleAITurn('ai3'); }, 4500);
});

// Initial setup on load
document.addEventListener('DOMContentLoaded', () => {
    nextWord(); 
    resetHandCricket();
    resetSnakesLadders();
    resetLudo();
});
</script>
</body>
</html>
